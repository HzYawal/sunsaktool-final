<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SunsakTool (ÏàúÏÇ≠Ìà¥)</title>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=IBM+Plex+Sans+KR:wght@400;700&family=Gowun+Dodum&family=Gowun+Batang&family=Nanum+Myeongjo:wght@400;700;800&family=Do+Hyeon&family=Black+Han+Sans&family=Gaegu:wght@400;700&family=Hi+Melody&family=Noto+Serif+KR:wght@400;700&family=Dokdo&display=swap');
        @font-face { font-family: 'Pretendard'; src: url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff'); font-weight: 400; }
        @font-face { font-family: 'Spoqa Han Sans Neo'; src: url('https://cdn.jsdelivr.net/gh/spoqa/spoqa-han-sans@latest/Subset/SpoqaHanSansNeo/SpoqaHanSansNeo-Regular.woff2') format('woff2'); font-weight: 400; }
        @font-face { font-family: 'GmarketSans'; src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansBold.woff') format('woff'); }
        :root { --st-accent-color: #e82c43; --st-bg-color: #1e1e1e; --st-panel-color: #2a2a2a; --st-border-color: #383838; --st-text-color: #e0e0e0; --st-subtext-color: #aaa; --st-interact-color: #4a90e2;}
        * { box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--st-bg-color); color: var(--st-text-color); display: flex; height: 100vh; margin: 0; overflow: hidden; -webkit-font-smoothing: antialiased; }
        .st-panel { height: 100vh; display: flex; flex-direction: column; }
        .st-sidebar { width: 280px; background-color: var(--st-panel-color); padding: 20px; border-right: 1px solid var(--st-border-color); overflow-y: auto;}
        .st-main-container { flex-grow: 1; display: flex; flex-direction: column; }
        .st-top-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background-color: var(--st-panel-color); border-bottom: 1px solid var(--st-border-color); flex-shrink: 0; height: 50px;}
        .st-logo { font-family: 'GmarketSans', sans-serif; font-weight: bold; }
        .st-main-content { display: flex; flex-grow: 1; overflow: hidden; }
        .st-preview-area { flex-basis: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .st-editor-area { flex-grow: 1; border-left: 1px solid var(--st-border-color); overflow-y: auto; padding: 20px; }
        button { background-color: var(--st-accent-color); color: #fff; font-weight: bold; cursor: pointer; border: none; border-radius: 4px; padding: 8px 12px; }
        button:disabled { background-color: #555; cursor: not-allowed; }
        .st-preview-panel { width: 100%; max-width: 380px; aspect-ratio: 9 / 16; background-color: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.2); display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .st-preview-header { font-family: 'GmarketSans', sans-serif; color: white; font-weight: bold; flex-shrink: 0; height: 65px; display: flex; justify-content: center; align-items: center; padding: 0 15px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .st-preview-content { padding: 10px; color: black; flex-grow: 1; display: flex; flex-direction: column; background-color: white; overflow: hidden; position: relative; }
        .st-project-info { font-size: 13px; color: #555; margin: 0 0 16px 0; border-bottom: 1px solid #eee; padding-bottom: 16px; flex-shrink: 0; }
        .st-project-info .title { font-size: 22px; color: black; font-weight: bold; margin-bottom: 5px; }
        .st-script-display { flex-grow: 1; position: relative; }
        .interactive-target { position: absolute; width: 100%; text-align: center; }
        #st-preview-text-container-wrapper { top: 0; }
        #st-preview-image-container-wrapper { top: 120px; height: 50%; }
        #st-preview-source-container-wrapper { bottom: 5px; right: 5px; width: auto; max-width: 95%; font-size: 10px; color: #888; text-align: right;}
        .interactive-target.interactive-active { outline: 2px dashed var(--st-interact-color); z-index: 100; }
        .resize-handle { position: absolute; width: 12px; height: 12px; background: white; border-radius: 50%; border: 2px solid var(--st-interact-color); z-index: 101; display: none; }
        /* ‚ú® ÌöåÏ†Ñ Ìï∏Îì§ Ïä§ÌÉÄÏùº Ï∂îÍ∞Ä */
        .rotation-handle { position: absolute; bottom: -35px; left: 50%; transform: translateX(-50%); width: 24px; height: 24px; background-color: white; border-radius: 50%; border: 1px solid #ccc; cursor: grab; display: none; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .rotation-handle:active { cursor: grabbing; }
        .interactive-active .resize-handle, .interactive-active .rotation-handle { display: flex; }
        #st-preview-text, #st-preview-source-text { width: 100%; white-space: pre-wrap; }
        #st-preview-image { max-width: 100%; max-height: 100%; object-fit: contain; }
        .st-timeline-controls { width: 100%; max-width: 380px; display: flex; align-items: center; gap: 10px; margin-top: 15px;}
        .st-play-all-btn { background: none; font-size: 24px; padding: 0;}
        #st-timeline-slider { flex-grow: 1; }
        .st-editor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .st-card { background-color: var(--st-panel-color); border: 2px solid transparent; padding: 15px; margin-top: 15px; border-radius: 4px; cursor: pointer; position: relative; }
        .st-card.active { border-color: var(--st-accent-color); }
        .st-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .st-card-drag-handle { cursor: grab; }
        .st-card-number { font-weight: bold; font-size: 18px; }
        textarea { width:100%; min-height:60px; background-color: #333; border: 1px solid var(--st-border-color); color: var(--st-text-color); border-radius: 4px; padding: 8px; }
        .st-card-footer { margin-top: 10px; display: flex; flex-direction: column; gap: 10px; }
        .st-card-footer .footer-row { display: flex; align-items: center; gap: 10px; font-size: 13px; flex-wrap: wrap; }
        .st-card-footer .st-duration-label { cursor: pointer; text-decoration: underline; }
        .st-card-footer .st-duration-input { width: 60px; padding: 2px 4px; }
        .st-card-footer .st-volume-slider { width: 70px; padding: 0 5px; }
        input[type="file"] { display: none; }
        .st-action-btn { background: none; border:none; color: var(--st-subtext-color); text-decoration: underline; cursor: pointer; padding: 0; font-size: 13px; }
        .st-play-clip-btn { font-size: 18px; background: none; padding: 0 5px; cursor: pointer; border: none; color: var(--st-text-color); }
        .st-play-clip-btn:disabled { color: #555; cursor: not-allowed; }
        .st-card-loading { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); color: white; display: flex; justify-content: center; align-items: center; z-index: 10; border-radius: 4px; font-weight: bold; }
        .st-accordion-header { padding: 12px 0; cursor: pointer; border-bottom: 1px solid var(--st-border-color); font-weight: bold; }
        .st-accordion-content { padding: 15px 0; display: none; }
        .st-accordion-item.active .st-accordion-content { display: block; }
        .st-control-group { margin-bottom: 15px; }
        input, select { width: 100%; padding: 8px; background-color: #1e1e1e; border: 1px solid var(--st-border-color); color: var(--st-text-color); }
        .st-flex-group { display: flex; gap: 10px; }
        .st-modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .st-modal-overlay.visible { display: flex; }
        .st-modal-dialog { background-color: var(--st-panel-color); padding: 24px; border-radius: 8px; width: 90%; max-width: 600px; border: 1px solid var(--st-border-color); }
        .st-modal-dialog .st-modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 24px; }
        #st-waveform-container { width: 100%; height: 128px; background-color: #1e1e1e; }
        #st-waveform-loading { text-align: center; padding: 40px; color: var(--st-subtext-color); }
        #st-export-progress-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; color: white; display: none; flex-direction: column; justify-content: center; align-items: center; font-size: 24px; }
        #st-export-progress-text { font-weight: bold; margin-bottom: 10px; }
        #st-export-progress-subtext { font-size: 16px; color: var(--st-subtext-color); }
        #st-export-progress-bar { width: 80%; max-width: 400px; height: 20px; background: #555; margin-top: 20px; border-radius: 10px; overflow: hidden; }
        #st-export-progress-bar-inner { width: 0%; height: 100%; background: var(--st-accent-color); transition: width 0.1s linear; }
    </style>
</head>
<body>
    <div class="st-panel st-sidebar" id="st-settings-panel"></div>
    <div class="st-main-container">
        <div class="st-top-header">
            <div class="st-logo">SunsakTool</div>
            <button id="st-btn-export-video">üé¨ 1080p ÏòÅÏÉÅ ÏÉùÏÑ±</button>
        </div>
        <div class="st-main-content">
            <div class="st-panel st-preview-area">
                <div class="st-preview-panel" id="st-preview-panel">
                     <div class="st-preview-header"></div><div class="st-preview-content"><div class="st-project-info"><div class="title"></div><span></span></div><div class="st-script-display"><div id="st-preview-text-container-wrapper" class="interactive-target" data-layout-key="text"><div id="st-preview-text"></div></div><div id="st-preview-image-container-wrapper" class="interactive-target" data-layout-key="image"><img id="st-preview-image"></div><div id="st-preview-source-container-wrapper" class="interactive-target" data-layout-key="source" style="display: none;"><div id="st-preview-source-text"></div></div></div></div>
                </div>
                <div class="st-timeline-controls">
                    <button class="st-play-all-btn" id="st-btn-play-all">‚ñ∂</button>
                    <input type="range" id="st-timeline-slider" value="0" step="0.1">
                </div>
            </div>
            <div class="st-panel st-editor-area">
                <div class="st-editor-header">
                    <h3>Ïä§ÌÅ¨Î¶ΩÌä∏ & ÌÉÄÏûÑÎùºÏù∏</h3>
                    <div class="button-group">
                        <button id="st-btn-add-project" style="background-color: #555;">+ ÏÉà ÌîÑÎ°úÏ†ùÌä∏</button>
                        <button id="st-btn-add-gpts" style="background-color: #3e3e3e;">‚ú® AI ÎåÄÎ≥∏ ÏÉùÏÑ±</button>
                        <button id="st-btn-add-card">+ ÏàòÎèô Ï∂îÍ∞Ä</button>
                    </div>
                </div>
                <div id="st-card-container"></div>
            </div>
        </div>
    </div>
    
    <div id="st-modal-gpts" class="st-modal-overlay"> <div class="st-modal-dialog"> <h2>AI ÎåÄÎ≥∏ Î∂ôÏó¨ÎÑ£Í∏∞</h2> <p>AI Ìà¥(ChatGPT, Claude Îì±)ÏóêÏÑú ÏÉùÏÑ±Îêú Ïä§ÌÅ¨Î¶ΩÌä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî. Îπà Ï§ÑÎ°ú Íµ¨Î∂ÑÌïòÏó¨ Ïó¨Îü¨ Ïä§ÌÅ¨Î¶ΩÌä∏Î•º ÌïúÎ≤àÏóê Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§.</p> <textarea id="st-gpts-textarea" placeholder="Ïó¨Í∏∞Ïóê AI Ïä§ÌÅ¨Î¶ΩÌä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea> <div class="st-modal-actions"> <button id="st-btn-gpts-cancel" class="cancel">Ï∑®ÏÜå</button> <button id="st-btn-gpts-confirm">ÌôïÏù∏</button> </div> </div> </div>
    <div id="st-modal-bgm" class="st-modal-overlay"> <div class="st-modal-dialog"> <h2>BGM Íµ¨Í∞Ñ ÏÑ§Ï†ï</h2> <p>Ïò§ÎîîÏò§ ÌååÌòï ÏúÑÏóêÏÑú ÏõêÌïòÎäî Íµ¨Í∞ÑÏùÑ ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.</p> <div id="st-waveform-container"> <div id="st-waveform-loading">BGM Î°úÎî© Ï§ë...</div> </div> <div class="st-waveform-controls"> <button id="st-btn-bgm-play-pause">Ïû¨ÏÉù/ÏùºÏãúÏ†ïÏßÄ</button> <button id="st-btn-bgm-play-region">ÏÑ†ÌÉù Íµ¨Í∞Ñ ÎØ∏Î¶¨Îì£Í∏∞</button> <span id="st-bgm-time-display">0.00s - 0.00s</span> </div> <div class="st-modal-actions"> <button id="st-btn-bgm-cancel" class="cancel">Ï∑®ÏÜå</button> <button id="st-btn-bgm-confirm">ÌôïÏù∏</button> </div> </div> </div>

    <div id="st-export-progress-overlay">
        <div id="st-export-progress-text">ÏòÅÏÉÅ ÏÉùÏÑ± Ï§ë...</div>
        <div id="st-export-progress-subtext"></div>
        <div id="st-export-progress-bar">
            <div id="st-export-progress-bar-inner"></div>
        </div>
    </div>
    <canvas id="st-render-canvas" style="display: none;"></canvas>

    <audio id="st-tts-player" style="display:none;"></audio>
    <audio id="st-bgm-player" style="display:none;" loop></audio>
    <audio id="st-sfx-player" style="display:none;"></audio>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/6.4.0/wavesurfer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/6.4.0/plugin/wavesurfer.regions.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // ... (Ïù¥Ï†Ñ ÏΩîÎìúÏùò FONT_LIST, BGM_LIST, SFX_LIST Î∞è Ï†ÑÏó≠ Î≥ÄÏàò ÏÑ†Ïñ∏Î∂Ä)
        const FONT_LIST = [ { name: 'ÌîÑÎ¶¨ÌÖêÎã§Îìú (Î≥∏Î¨∏Ïö© Ï∂îÏ≤ú)', value: 'Pretendard' }, { name: 'Noto Sans KR (Í∏∞Î≥∏ Í≥†Îîï)', value: "'Noto Sans KR', sans-serif" }, { name: 'GÎßàÏºì ÏÇ∞Ïä§ (Í∞úÏÑ±ÏûàÎäî Ï†úÎ™©)', value: 'GmarketSans' }, { name: 'IBM Plex Sans KR (Î™®ÎçòÌïú Í≥†Îîï)', value: "'IBM Plex Sans KR', sans-serif" }, { name: 'Do Hyeon (Î†àÌä∏Î°ú Ï†úÎ™©)', value: "'Do Hyeon', sans-serif" }, { name: 'ÎÇòÎàîÎ™ÖÏ°∞ (Í∞êÏÑ±Ï†ÅÏù∏ Î≥∏Î¨∏)', value: "'Nanum Myeongjo', serif" }, { name: 'Í≥†Ïö¥ Î∞îÌÉï (Î∂ÄÎìúÎü¨Ïö¥ Î™ÖÏ°∞)', value: "'Gowun Batang', serif" }, { name: 'Black Han Sans (Í∞ïÎ†•Ìïú Ï†úÎ™©)', value: "'Black Han Sans', sans-serif" }, { name: 'Í∞úÍµ¨ (Í∑ÄÏó¨Ïö¥ ÏÜêÍ∏ÄÏî®)', value: "'Gaegu', cursive" }, { name: 'Hi Melody (ÏïÑÍ∏∞ÏûêÍ∏∞ ÏÜêÍ∏ÄÏî®)', value: "'Hi Melody', cursive" }, { name: 'Noto Serif KR (Ï†ïÍ∞àÌïú Î™ÖÏ°∞)', value: "'Noto Serif KR', serif" }, { name: 'Ïä§Ìè¨Ïπ¥ Ìïú ÏÇ∞Ïä§ ÎÑ§Ïò§ (ÍπîÎÅîÌïú Î≥∏Î¨∏)', value: "'Spoqa Han Sans Neo', sans-serif" }, { name: 'ÎèÖÎèÑ (Í±∞Ïπú Î∂ìÍ∏ÄÏî®)', value: "'Dokdo', cursive" }, ];
        const BGM_LIST = [ { name: 'ÏÑ†ÌÉù ÏïàÌï®', url: '' }, { name: 'big-cafe', url: 'https://sunsaktool-final.netlify.app/big-cafe.mp3' }, { name: 'blue-jacket', url: 'https://sunsaktool-final.netlify.app/blue-jacket.mp3' }, { name: 'cute-puppy', url: 'https://sunsaktool-final.netlify.app/cute-puppy.mp3' }, { name: 'laughter-in-the-breeze', url: 'https://sunsaktool-final.netlify.app/laughter-in-the-breeze-_happy_.mp3' }, { name: 'murder-in-my-mind', url: 'https://sunsaktool-final.netlify.app/murder-in-my-mind.mp3' }, { name: 'smiley-composure', url: 'https://sunsaktool-final.netlify.app/smiley-composure.mp3' }, { name: 'spider', url: 'https://sunsaktool-final.netlify.app/spider.mp3' }, { name: 'white-color', url: 'https://sunsaktool-final.netlify.app/white-color.mp3' } ];
        const SFX_LIST = [ { name: 'Ìö®Í≥ºÏùå ÏóÜÏùå', url: '' }, { name: 'Îæ± (Î¨ºÎ∞©Ïö∏)', url: `https://sunsaktool-final.netlify.app/sfx/062_${encodeURIComponent('Îæ± (Î¨ºÎ∞©Ïö∏)')}.mp3` }, { name: 'Ï∞∞Ïπµ (Ïπ¥Î©îÎùº)', url: `https://sunsaktool-final.netlify.app/sfx/078_${encodeURIComponent('Ï∞∞Ïπµ (Ïπ¥Î©îÎùº)')}.mp3` }, { name: 'Í∏∞Ïñ¥ 1', url: 'https://sunsaktool-final.netlify.app/sfx/gears 1.wav' }, { name: 'Í≤åÏûÑÌÅ¥Î¶¨Ïñ¥ (Í≥†Ïùå)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Í≤åÏûÑÌÅ¥Î¶¨Ïñ¥ (Í≥†Ïùå)')}.mp3` }, { name: 'Í∏çÏ†ïÏ†Å ÎßàÎ≤ï ÏÇ¨Ïö©', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Í∏çÏ†ïÏ†Å ÎßàÎ≤ï ÏÇ¨Ïö©')}.mp3` }, { name: 'Íπ®Îã¨Ïùå(Îæ∞Î¥â)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Íπ®Îã¨ÏùåÏùÑ ÏñªÏóàÏùÑ Îïå(Îæ∞Î¥â)')}.mp3` }, { name: 'ÎÜÄÎûå Î∞òÏ†Ñ', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÎÜÄÎûå Î∞òÏ†Ñ')}.mp3` }, { name: 'Îã§Ïùå Ïû•Î©¥Ï†ÑÌôò(Îæ∞Î°úÎ°±)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Îã§Ïùå Ïû•Î©¥Ï†ÑÌôò(Îæ∞Î°úÎ°±)')}.mp3` }, { name: 'ÎÑòÏñ¥Í∞ÄÎäî ÎßëÏùÄ ÏÜåÎ¶¨(Îù†ÎßÅ~)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Îã§ÏùåÏúºÎ°ú ÎÑòÏñ¥Í∞ÄÎäî ÎßëÏùÄ ÏÜåÎ¶¨(Îù†ÎßÅ~)')}.mp3` }, { name: 'ÎèôÏ†ÑÎ®πÎäîÏÜåÎ¶¨ 2Ïó∞ÏÜç(Ï§ëÏùå)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÎèôÏ†ÑÎ®πÎäîÏÜåÎ¶¨ 2Ïó∞ÏÜç(Ï§ëÏùå)')}.mp3` }, { name: 'Îî©ÎèôÎåïÎèô (Ï†ÑÏûêÏùå)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Îî©ÎèôÎåïÎèô (Ï†ÑÏûêÏùå)')}.mp3` }, { name: 'Î¨∏Ïûê Ï†ÑÏÜ°Ïùå(ÎòêÎ°úÎ°±)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Î¨∏Ïûê Ï†ÑÏÜ°Ïùå(ÎòêÎ°úÎ°±)')}.mp3` }, { name: 'Î≥µÏã± ÌÉÄÏù¥Î®∏(Îï°Îï°Îï°)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Î≥µÏã± ÌõàÎ†® ÌÉÄÏù¥Î®∏Í∞Ä Ïö∏Î¶¨Îäî ÏÜåÎ¶¨ (Îï°Îï°Îï°)')}.mp3` }, { name: 'ÎπÑÎîîÏò§ Îπ®Î¶¨Í∞êÍ∏∞ ÏòàÎä•Ïùå', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÎπÑÎîîÏò§ ÌÖåÏù¥ÌîÑ Îπ®Î¶¨Í∞êÍ∏∞ ÏòàÎä•Ïùå')}.mp3` }, { name: 'Îæ∞Î°úÎ°±', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Îæ∞Î°úÎ°±')}.mp3` }, { name: 'Ìúô ÎÇ†Ïπ¥Î°≠Í≤å ÏßÄÎÇòÍ∞ÄÎäî', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ìúô ÎÇ†Ïπ¥Î°≠Í≤å ÏßÄÎÇòÍ∞ÄÎäî')}.mp3` }, { name: 'ÏãúÌïúÌè≠ÌÉÑ Ï¥àÏãúÍ≥Ñ (timer)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÏãúÌïúÌè≠ÌÉÑ Ï¥àÏãúÍ≥Ñ (timer)')}.mp3` }, { name: 'ÏïåÎûå ÏãúÍ∞Ñ Ï¢ÖÎ£å -2 (Ï∞®Î∂Ñ_ beep)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÏïåÎûå ÏãúÍ∞Ñ Ï¢ÖÎ£å -2 (Ï∞®Î∂Ñ_ beep)')}.mp3` }, { name: 'ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ ÎèÑÏ∞©Ïùå2 (ÎùµÎèô)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ ÎèÑÏ∞©Ïùå2 (ÎùµÎèô)')}.mp3` }, { name: 'Ïöï Í∞ÄÎ¶¨Îäî ÏÇêÏ≤òÎ¶¨', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ïöï Í∞ÄÎ¶¨Îäî ÏÇêÏ≤òÎ¶¨')}.mp3` }, { name: 'ÏûëÏùÄ Ïπ¥Î©îÎùº Ï∞∞Ïπµ ÏÜåÎ¶¨', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÏûëÏùÄ Ïπ¥Î©îÎùº Ï∞∞Ïπµ ÏÜåÎ¶¨')}.mp3` }, { name: 'Ï†ÄÎÖÅÏà≤ (Í∞úÍµ¨Î¶¨, Í≥§Ï∂©)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ï†ÄÎÖÅÏà≤ (Í∞úÍµ¨Î¶¨ÏôÄ Í≥§Ï∂©Ïö∏ÏùåÏÜåÎ¶¨)')}.mp3` }, { name: 'ÌîåÎûòÎûò Í±∏Ïñ¥Í∞ÄÎäî ÏÜåÎ¶¨(ÎΩÄÎ≥µ)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÌîåÎûòÎûò Í±∏Ïñ¥Í∞ÄÎäî ÏÜåÎ¶¨(ÎΩÄÎ≥µ)')}.mp3` }, { name: 'Ï≤úÏÇ¨Ïùò Í∞ïÎ¶º', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ï≤úÏÇ¨Ïùò Í∞ïÎ¶º')}.mp3` }, { name: 'Í∞úÏÑú (Ï≤†Ïª•Ïøµ)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Í∞úÏÑú (Ï≤†Ïª•Ïøµ)')}.mp3` }, { name: 'Ïª¥Ìì®ÌÑ∞ ÌÇ§Î≥¥Îìú ÌÉÄÏûê', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ïª¥Ìì®ÌÑ∞ ÌÇ§Î≥¥Îìú ÌÉÄÏûê')}.mp3` }, { name: 'ÌÉÄÏù¥Î®∏ (Ïß∏ÍπçÏß∏Íπç)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÌÉÄÏù¥Î®∏ Ïû¨Îäî ÏãúÍ≥ÑÏùå(Ïß∏ÍπçÏß∏Íπç)')}.mp3` }, { name: 'Ìô©ÎãπÌï† Îïå (Îù†ÏöîÏòπ)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ìô©ÎãπÌï† Îïå Ìö®Í≥ºÏùå (Îù†ÏöîÏòπ)')}.mp3` }, { name: 'Riser 1', url: 'https://sunsaktool-final.netlify.app/sfx/riser 1.wav' }, { name: 'Whoosh 1', url: 'https://sunsaktool-final.netlify.app/sfx/whoosh1.mp3' }, { name: 'Whoosh 2', url: 'https://sunsaktool-final.netlify.app/sfx/whoosh2.mp3' }, { name: 'Whoosh 3', url: 'https://sunsaktool-final.netlify.app/sfx/whoosh3.wav' }, { name: 'Whoosh 4', url: 'https://sunsaktool-final.netlify.app/sfx/whoosh4.mp3' }, { name: 'ÎòêÎ°úÎ°±', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÎòêÎ°úÎ°±')}.wav` }, { name: 'ÎòêÏïÑÏïô', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÎòêÏïÑÏïô')}.wav` }, { name: 'Îù†Î°úÎ°ù', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Îù†Î°úÎ°ù')}.mp3` }, { name: 'Îù†Î°±(ÏäàÌçºÎßàÎ¶¨Ïò§)', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Îù†Î°±_ÏäàÌçºÎßàÎ¶¨Ïò§')}.mp3` }, { name: 'Îù†Î¶¨ÎßÅ', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Îù†Î¶¨ÎßÅ')}.wav` }, { name: 'Îù†ÎßÅ 1', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ1.wav' }, { name: 'Îù†ÎßÅ 1Ï¥à', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ1Ï¥à.mp3' }, { name: 'Îù†ÎßÅ 2', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ2.mp3' }, { name: 'Îù†ÎßÅ 2Ï¥à', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ2Ï¥à.mp3' }, { name: 'Îù†ÎßÅ 3', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ3.mp3' }, { name: 'Îù†ÎßÅ 4', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ4.wav' }, { name: 'Îùµ', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Îùµ')}.mp3` }, { name: 'ÎßàÏö∞Ïä§ÌÅ¥Î¶≠(Îî∏Íπç)', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÎßàÏö∞Ïä§ÌÅ¥Î¶≠_Îî∏Íπç')}.mp3` }, { name: 'Îæ∞Ïò• 1', url: 'https://sunsaktool-final.netlify.app/sfx/Îæ∞Ïò•1.wav' }, { name: 'Îæ∞Ïò• 2', url: 'https://sunsaktool-final.netlify.app/sfx/Îæ∞Ïò•2.mp3' }, { name: 'Îæ∞Ïò• 3', url: 'https://sunsaktool-final.netlify.app/sfx/Îæ∞Ïò•3.wav' }, { name: 'ÎΩÅ 1Ï¥à', url: 'https://sunsaktool-final.netlify.app/sfx/ÎΩÅ1Ï¥à.mp3' }, { name: 'ÏÇêÎ¶¨ÏÇêÎπÖ', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÏÇêÎ¶¨ÏÇêÎπÖ')}.mp3` }, { name: 'ÏÇë', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÏÇë')}.mp3` }, { name: 'ÏÖîÌÑ∞', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÏÖîÌÑ∞')}.wav` }, { name: 'Ïäâ 1Ï¥à', url: 'https://sunsaktool-final.netlify.app/sfx/Ïäâ1Ï¥à.mp3' }, { name: 'Ïä§ÏúΩ', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Ïä§ÏúΩ')}.mp3` }, { name: 'Ïòà!', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Ïòà!')}.mp3` }, { name: 'ÏôÄÏö∞', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÏôÄÏö∞')}.wav` }, { name: 'Ï∞∞Ïπµ(ÏÜåÎ¶¨)', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Ï∞∞Ïπµ')}.wav` }, { name: 'Ï∫êÏÑú', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Ï∫êÏÑú')}.mp3` }, { name: 'ÌÇ§Î≥¥ÎìúÌÉÄÏù¥Ìïë', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÌÇ§Î≥¥ÎìúÌÉÄÏù¥Ìïë')}.mp3` }, { name: 'ÌàΩ', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÌàΩ')}.mp3` }, { name: 'Ìè≠Î∞ú 1', url: 'https://sunsaktool-final.netlify.app/sfx/Ìè≠Î∞ú1.mp3' }, { name: 'Ìè≠Î∞ú 2', url: 'https://sunsaktool-final.netlify.app/sfx/Ìè≠Î∞ú2.mp3' }, { name: 'Ìè≠Î∞ú(ÌÅ∞)', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Ìè≠Î∞ú_ÌÅ∞')}.mp3` }, { name: 'ÌõÑÏö±', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÌõÑÏö±')}.mp3` } ];
        
        let globalBGM = { url: null, volume: 0.3, startTime: 0, endTime: null };
        let scriptCards = [];
        let isPlaying = false;
        let ttsCache = new Map();
        let playbackCurrentIndex = 0;
        let selectedCardId = null;
        let activeInteractiveElement = null;
        let playbackTimeoutId = null;

        const cardContainer = document.getElementById('st-card-container');
        const playAllBtn = document.getElementById('st-btn-play-all');
        const timelineSlider = document.getElementById('st-timeline-slider');
        const ttsPlayer = document.getElementById('st-tts-player');
        const bgmPlayer = document.getElementById('st-bgm-player');
        const sfxPlayer = document.getElementById('st-sfx-player'); 
        const settingsPanel = document.getElementById('st-settings-panel');
        const addCardBtn = document.getElementById('st-btn-add-card');
        const addGptsBtn = document.getElementById('st-btn-add-gpts');
        const newProjectBtn = document.getElementById('st-btn-add-project');
        const gptsModal = document.getElementById('st-modal-gpts');
        const gptsCancelBtn = document.getElementById('st-btn-gpts-cancel');
        const gptsConfirmBtn = document.getElementById('st-btn-gpts-confirm');
        const gptsTextarea = document.getElementById('st-gpts-textarea');
        let wavesurfer = null;
        let activeRegion = null;
        let bgmEditorContext = { onConfirm: null, onCancel: null };
        
        function initializeBgmEditor() { if (wavesurfer) return; if (typeof WaveSurfer === 'undefined') { return alert("BGM Ìé∏ÏßëÍ∏∞ ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎî©Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ÌïòÍ≥† ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ® Ìï¥Ï£ºÏÑ∏Ïöî."); } wavesurfer = WaveSurfer.create({ container: '#st-waveform-container', waveColor: '#ddd', progressColor: '#e82c43', cursorColor: '#fff', barWidth: 2, barRadius: 3, plugins: [ WaveSurfer.regions.create({ dragSelection: { slop: 5 } }) ] }); wavesurfer.on('error', (err) => { console.error('WaveSurfer Error:', err); alert('BGM ÌååÏùºÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.'); closeBgmEditor(); }); wavesurfer.on('ready', () => { document.getElementById('st-waveform-loading').style.display = 'none'; wavesurfer.clearRegions(); const totalDuration = wavesurfer.getDuration(); const regionDuration = Math.min(60, totalDuration); let region = wavesurfer.addRegion({ start: 0, end: regionDuration, color: 'rgba(232, 44, 67, 0.3)', drag: true, resize: true }); activeRegion = region; document.getElementById('st-bgm-time-display').textContent = `${region.start.toFixed(2)}s - ${region.end.toFixed(2)}s`; }); wavesurfer.on('region-updated', (region) => { activeRegion = region; document.getElementById('st-bgm-time-display').textContent = `${region.start.toFixed(2)}s - ${region.end.toFixed(2)}s`; }); wavesurfer.on('region-clicked', (region, e) => { e.stopPropagation(); activeRegion = region; region.play(); }); document.getElementById('st-btn-bgm-play-pause').addEventListener('click', () => wavesurfer.playPause()); document.getElementById('st-btn-bgm-play-region').addEventListener('click', () => { if (activeRegion) activeRegion.play(); }); document.getElementById('st-btn-bgm-confirm').addEventListener('click', () => { if (bgmEditorContext.onConfirm && activeRegion) { bgmEditorContext.onConfirm({ startTime: activeRegion.start, endTime: activeRegion.end }); } closeBgmEditor(); }); document.getElementById('st-btn-bgm-cancel').addEventListener('click', () => { if (bgmEditorContext.onCancel) { bgmEditorContext.onCancel(); } closeBgmEditor(); }); }
        function openBgmEditor(url, callbacks) { bgmEditorContext = callbacks; document.getElementById('st-modal-bgm').classList.add('visible'); document.getElementById('st-waveform-loading').style.display = 'block'; if (wavesurfer) { wavesurfer.destroy(); wavesurfer = null; } initializeBgmEditor(); wavesurfer.load(url); }
        function closeBgmEditor() { document.getElementById('st-modal-bgm').classList.remove('visible'); if (wavesurfer) { wavesurfer.destroy(); wavesurfer = null; } }
        const debounce = (callback, delay) => { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => callback(...args), delay); }; };
        const getAudioDuration = (url) => new Promise(resolve => { const audio = new Audio(); audio.onloadedmetadata = () => resolve(audio.duration); audio.onerror = () => resolve(0.5); audio.src = url; });
        async function fetchTTS(text, cardId) { text = text.trim(); if (!text) return null; const cacheKey = text; if (ttsCache.has(cacheKey)) return ttsCache.get(cacheKey); showLoadingOnCard(cardId, true, 'ÏÑúÎ≤ÑÏóê ÏöîÏ≤≠ Ï§ë...'); try { const response = await fetch('/.netlify/functions/create-tts', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ text: text }) }); if (!response.ok) { const errorResult = await response.json(); throw new Error(`[${response.status}] ${errorResult.error || 'ÏÑúÎ≤Ñ ÏöîÏ≤≠ Ïã§Ìå®'}`); } const result = await response.json(); const audioUrl = result.audioUrl; const duration = await getAudioDuration(audioUrl); const ttsData = { audioUrl, duration }; ttsCache.set(cacheKey, ttsData); return ttsData; } catch (error) { console.error('TTS ÏÉùÏÑ± Ïò§Î•ò:', error); alert(`ÏùåÏÑ± ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}`); return null; } finally { showLoadingOnCard(cardId, false); } }
        function renderControls() { const fontOptions = FONT_LIST.map(font => `<option value="${font.value}" style="font-family: ${font.value};">${font.name}</option>`).join(''); const bgmOptions = BGM_LIST.map(bgm => `<option value="${bgm.url}">${bgm.name}</option>`).join(''); settingsPanel.innerHTML = `<div class="st-accordion-item active"><div class="st-accordion-header">Ìó§Îçî Ïä§ÌÉÄÏùº</div><div class="st-accordion-content"><div class="st-control-group"><label>Ìó§Îçî ÌÖçÏä§Ìä∏</label><input type="text" id="st-setting-header-text" value="Ïç∞Ïëà"></div><div class="st-flex-group"><div><label>Î∞∞Í≤Ω ÏÉâÏÉÅ</label><input type="color" id="st-setting-header-bg" value="#e82c43"></div><div><label>Í∏ÄÏûê ÏÉâÏÉÅ</label><input type="color" id="st-setting-header-color" value="#FFFFFF"></div></div><div class="st-flex-group"><div><label>Ìè∞Ìä∏</label><select id="st-setting-header-font">${fontOptions}</select></div><div><label>ÌÅ¨Í∏∞</label><input type="number" id="st-setting-header-size" value="24"></div></div></div></div><div class="st-accordion-item"><div class="st-accordion-header">Ïä§ÌÅ¨Î¶ΩÌä∏ Ïä§ÌÉÄÏùº</div><div class="st-accordion-content"><div class="st-control-group"><label>ÌÖçÏä§Ìä∏ ÏÉâÏÉÅ</label><input type="color" id="st-setting-script-color" value="#000000"></div><div class="st-flex-group"><div><label>Ìè∞Ìä∏</label><select id="st-setting-script-font">${fontOptions}</select></div><div><label>ÌÅ¨Í∏∞</label><input type="number" id="st-setting-script-size" value="24"></div></div></div></div><div class="st-accordion-item"><div class="st-accordion-header">ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥</div><div class="st-accordion-content"><div class="st-control-group"><label>Ï†úÎ™©</label><input type="text" id="st-setting-project-title" value=""></div><div class="st-control-group"><label>ÏûëÏÑ±Ïûê</label><input type="text" id="st-setting-project-author" value=""></div><div class="st-control-group"><label>Ï°∞ÌöåÏàò</label><input type="number" id="st-setting-project-views" value="0"></div><div class="st-flex-group"><div><label>Ï†úÎ™© ÏÉâÏÉÅ</label><input type="color" id="st-setting-title-color" value="#000000"></div><div><label>ÏûëÏÑ±Ïûê/Ï°∞ÌöåÏàò ÏÉâÏÉÅ</label><input type="color" id="st-setting-meta-color" value="#555555"></div></div></div></div><div class="st-accordion-item"><div class="st-accordion-header">Î∞∞Í≤ΩÏùåÏïÖ ÏÑ§Ï†ï</div><div class="st-accordion-content"><div class="st-control-group"><label>Ï†ÑÏ≤¥ Î∞∞Í≤ΩÏùåÏïÖ ÏÑ†ÌÉù</label><select id="st-setting-global-bgm">${bgmOptions}</select></div><div class="st-control-group"><label>BGM Î≥ºÎ•®</label><input type="range" id="st-setting-global-bgm-volume" min="0" max="1" step="0.01" value="${globalBGM.volume}"></div></div></div>`; document.querySelectorAll('#st-settings-panel input, #st-settings-panel select').forEach(el => { if (el.id.includes('script')) { el.addEventListener('input', applyScriptStylesToSelectedCard); } else { el.addEventListener('input', updatePreviewDisplay); } }); document.querySelectorAll('.st-accordion-header').forEach(h => h.addEventListener('click', () => h.parentElement.classList.toggle('active'))); const globalBgmSelect = document.getElementById('st-setting-global-bgm'); globalBgmSelect.addEventListener('change', (e) => { const url = e.target.value; const originalUrl = globalBGM.url || ''; if (url) { openBgmEditor(url, { onConfirm: ({ startTime, endTime }) => { globalBGM = { ...globalBGM, url, startTime, endTime }; if (isPlaying) playBGM(); }, onCancel: () => { globalBgmSelect.value = originalUrl; } }); } else { globalBGM.url = null; if (isPlaying) bgmPlayer.pause(); } }); document.getElementById('st-setting-global-bgm-volume').addEventListener('input', (e) => { globalBGM.volume = parseFloat(e.target.value); if (bgmPlayer) bgmPlayer.volume = globalBGM.volume; }); }
        
        function addScriptCard(text = '') { const cardId = `card-${Date.now()}-${Math.floor(Math.random() * 10000)}`; const cardData = { id: cardId, text, duration: 0.5, ttsDuration: 0.5, isDurationManual: false, imageUrl: null, style: { color: document.getElementById('st-setting-script-color').value, fontFamily: document.getElementById('st-setting-script-font').value, fontSize: document.getElementById('st-setting-script-size').value + 'px' }, audioUrl: null, ttsReady: false, ttsVolume: 1, sfxUrl: null, sfxVolume: 1, source: { enabled: false, text: 'Ï∂úÏ≤ò:', layout: { x: 0, y: 0, scale: 1, angle: 0 } }, layout: { text: { x: 0, y: 0, scale: 1, angle: 0 }, image: { x: 0, y: 0, scale: 1, angle: 0 } } }; scriptCards.push(cardData); const cardEl = document.createElement('div'); cardEl.className = 'st-card'; cardEl.dataset.id = cardId; const sfxOptions = SFX_LIST.map(sfx => `<option value="${sfx.url || ''}">${sfx.name}</option>`).join(''); cardEl.innerHTML = `<div class="st-card-header st-card-drag-handle"><span class="st-card-number"></span><button class="st-btn-delete-card">üóëÔ∏è</button></div><textarea placeholder="Ïä§ÌÅ¨Î¶ΩÌä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">${text}</textarea><div class="st-card-footer"><div class="footer-row"><button class="st-play-clip-btn" title="ÎØ∏Î¶¨Îì£Í∏∞" disabled>‚ñ∂Ô∏è</button><span class="st-duration-label" title="ÌÅ¥Î¶≠ÌïòÏó¨ ÏûêÎèô/ÏàòÎèô Ï†ÑÌôò">ÌÉÄÏûÑÎùºÏù∏ (---Ï¥à)</span><input type="number" class="st-duration-input" min="0.1" step="0.1" value="0.5" title="Í∏∏Ïù¥(Ï¥à)"><label class="st-action-btn" for="${cardId}-file">Ïù¥ÎØ∏ÏßÄ</label><input type="file" id="${cardId}-file" accept="image/*"><button class="st-action-btn btn-add-source">[Ï∂úÏ≤ò Ï∂îÍ∞Ä]</button></div><div class="footer-row"><span>TTS ÏÜåÎ¶¨</span><input type="range" class="st-volume-slider tts-volume" min="0" max="1" step="0.05" value="1"><span style="margin-left:10px;">Ìö®Í≥ºÏùå ÏÜåÎ¶¨</span><input type="range" class="st-volume-slider sfx-volume" min="0" max="1" step="0.05" value="1"></div><div class="footer-row"><select class="st-sfx-select" style="flex-grow: 1;">${sfxOptions}</select></div></div>`; cardContainer.appendChild(cardEl); const fileInput = cardEl.querySelector(`#${cardId}-file`); const playClipBtn = cardEl.querySelector('.st-play-clip-btn'); const sfxSelect = cardEl.querySelector('.st-sfx-select'); const ttsVolumeSlider = cardEl.querySelector('.tts-volume'); const sfxVolumeSlider = cardEl.querySelector('.sfx-volume'); const durationLabel = cardEl.querySelector('.st-duration-label'); const durationInput = cardEl.querySelector('.st-duration-input'); const addSourceBtn = cardEl.querySelector('.btn-add-source'); fileInput.addEventListener('change', (e) => { if (e.target.files && e.target.files[0]) { const reader = new FileReader(); reader.onload = (event) => { cardData.imageUrl = event.target.result; if (selectedCardId === cardId) { updatePreviewDisplay(); } }; reader.readAsDataURL(e.target.files[0]); } }); playClipBtn.addEventListener('click', (e) => { e.stopPropagation(); stopPlayback(); if (cardData.ttsReady && cardData.audioUrl) { ttsPlayer.volume = cardData.ttsVolume; ttsPlayer.src = cardData.audioUrl; ttsPlayer.play(); } if(cardData.sfxUrl) { sfxPlayer.src = cardData.sfxUrl; sfxPlayer.volume = cardData.sfxVolume; sfxPlayer.play(); } }); sfxSelect.addEventListener('change', (e) => { cardData.sfxUrl = e.target.value || null; }); ttsVolumeSlider.addEventListener('input', (e) => { cardData.ttsVolume = parseFloat(e.target.value); }); sfxVolumeSlider.addEventListener('input', (e) => { cardData.sfxVolume = parseFloat(e.target.value); }); addSourceBtn.addEventListener('click', (e) => { e.stopPropagation(); cardData.source.enabled = !cardData.source.enabled; if (cardData.source.enabled && cardData.source.text.trim() === 'Ï∂úÏ≤ò:') { const newText = prompt('Ï∂úÏ≤ò ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:', ''); if (newText) { cardData.source.text = 'Ï∂úÏ≤ò: ' + newText; } else { cardData.source.enabled = false; } } if (selectedCardId === cardId) updatePreviewDisplay(); }); durationLabel.addEventListener('click', () => { cardData.isDurationManual = !cardData.isDurationManual; cardData.duration = cardData.isDurationManual ? parseFloat(durationInput.value) : cardData.ttsDuration; if (selectedCardId === cardId) updateCardUI(cardId); updateTotalDuration(); }); durationInput.addEventListener('input', () => { if (cardData.isDurationManual) { cardData.duration = parseFloat(durationInput.value) || 0.5; if (selectedCardId === cardId) updateCardUI(cardId); updateTotalDuration(); } }); const debouncedFetchAndUpdate = debounce(async (newText, id) => { const cardToUpdate = scriptCards.find(c => c.id === id); const ttsData = await fetchTTS(newText, id); if (ttsData && cardToUpdate) { cardToUpdate.ttsDuration = ttsData.duration; if (!cardToUpdate.isDurationManual) { cardToUpdate.duration = ttsData.duration; } cardToUpdate.audioUrl = ttsData.audioUrl; cardToUpdate.ttsReady = true; if(selectedCardId === id) updateCardUI(id); updateTotalDuration(); } }, 800); cardEl.querySelector('textarea').addEventListener('input', (e) => { cardData.text = e.target.value; if (selectedCardId === cardId) updatePreviewDisplay(); debouncedFetchAndUpdate(cardData.text, cardId); }); cardEl.querySelector('.st-btn-delete-card').addEventListener('click', (e) => { e.stopPropagation(); deleteCard(cardId); }); cardEl.addEventListener('click', () => selectCard(cardId)); if (text) debouncedFetchAndUpdate(text, cardId); if (!selectedCardId) selectCard(cardId); updateCardNumbers(); updateCardUI(cardId); }
        function updateCardUI(cardId) { const cardData = scriptCards.find(c => c.id === cardId); const cardEl = document.querySelector(`.st-card[data-id="${cardId}"]`); if (!cardData || !cardEl) return; cardEl.querySelector('.st-play-clip-btn').disabled = !cardData.ttsReady; cardEl.querySelector('.tts-volume').value = cardData.ttsVolume; cardEl.querySelector('.sfx-volume').value = cardData.sfxVolume; const durationLabel = cardEl.querySelector('.st-duration-label'); const durationInput = cardEl.querySelector('.st-duration-input'); durationInput.value = cardData.duration.toFixed(2); if (cardData.isDurationManual) { durationLabel.textContent = `Í∏∏Ïù¥(ÏàòÎèô):`; durationLabel.style.color = 'var(--st-accent-color)'; } else { durationLabel.textContent = `Í∏∏Ïù¥(ÏûêÎèô):`; durationLabel.style.color = ''; } }
        function deleteCard(cardId) { const cardIndex = scriptCards.findIndex(c => c.id === cardId); if(cardIndex === -1) return; scriptCards.splice(cardIndex, 1); document.querySelector(`.st-card[data-id="${cardId}"]`).remove(); if (selectedCardId === cardId) { selectedCardId = null; if(scriptCards.length > 0) { const nextIndex = Math.max(0, cardIndex - 1); if (scriptCards[nextIndex]) selectCard(scriptCards[nextIndex].id); } else { updatePreviewDisplay(); } } updateTotalDuration(); updateCardNumbers(); deactivateAllInteractive(); }
        function updateCardNumbers() { document.querySelectorAll('.st-card').forEach((card, index) => { card.querySelector('.st-card-number').textContent = index + 1; }); }
        function updateTotalDuration() { const total = scriptCards.reduce((sum, card) => sum + (card.duration || 0.5), 0); if(timelineSlider) timelineSlider.max = total; }
        function showLoadingOnCard(cardId, show, message = 'ÏùåÏÑ± ÏÉùÏÑ± Ï§ë...') { const cardEl = document.querySelector(`.st-card[data-id="${cardId}"]`); if (!cardEl) return; let overlay = cardEl.querySelector('.st-card-loading'); if (show) { if (!overlay) { overlay = document.createElement('div'); overlay.className = 'st-card-loading'; cardEl.appendChild(overlay); } overlay.textContent = message; } else { if (overlay) overlay.remove(); } }
        function selectCard(cardId, fromPlayback = false) { if (isPlaying && !fromPlayback) stopPlayback(); selectedCardId = cardId; deactivateAllInteractive(); document.querySelectorAll('.st-card').forEach(c => c.classList.remove('active')); const cardEl = document.querySelector(`.st-card[data-id="${cardId}"]`); if (cardEl) { cardEl.classList.add('active'); if (!fromPlayback) cardEl.scrollIntoView({ behavior: 'smooth', block: 'center' }); updateScriptStyleControls(); updatePreviewDisplay(); } else { updatePreviewDisplay(); } }
        function updatePreviewDisplay() { const headerEl = document.querySelector('.st-preview-header'); if (headerEl) { headerEl.textContent = document.getElementById('st-setting-header-text')?.value || ''; headerEl.style.backgroundColor = document.getElementById('st-setting-header-bg')?.value || '#e82c43'; headerEl.style.color = document.getElementById('st-setting-header-color')?.value || '#ffffff'; headerEl.style.fontFamily = document.getElementById('st-setting-header-font')?.value || 'GmarketSans'; headerEl.style.fontSize = (document.getElementById('st-setting-header-size')?.value || '24') + 'px'; } const titleEl = document.querySelector('.st-project-info .title'); if (titleEl) { titleEl.textContent = document.getElementById('st-setting-project-title')?.value || ''; titleEl.style.color = document.getElementById('st-setting-title-color')?.value || '#000'; } const metaEl = document.querySelector('.st-project-info span'); if (metaEl) { metaEl.textContent = `${document.getElementById('st-setting-project-author')?.value || ''} | Ï°∞ÌöåÏàò ${Number(document.getElementById('st-setting-project-views')?.value || 0).toLocaleString()}`; metaEl.style.color = document.getElementById('st-setting-meta-color')?.value || '#555'; } const card = scriptCards.find(c => c.id === selectedCardId); const textWrapper = document.getElementById('st-preview-text-container-wrapper'); const previewText = document.getElementById('st-preview-text'); const imageWrapper = document.getElementById('st-preview-image-container-wrapper'); const previewImage = document.getElementById('st-preview-image'); const sourceWrapper = document.getElementById('st-preview-source-container-wrapper'); const sourceText = document.getElementById('st-preview-source-text'); if (!textWrapper || !imageWrapper || !sourceWrapper) return; if (!card) { textWrapper.style.display = 'none'; imageWrapper.style.display = 'none'; sourceWrapper.style.display = 'none'; return; } textWrapper.style.display = 'block'; previewText.textContent = card.text; Object.assign(previewText.style, card.style); applyTransform(textWrapper, card.layout.text); if (card.imageUrl) { imageWrapper.style.display = 'block'; previewImage.src = card.imageUrl; } else { imageWrapper.style.display = 'none'; } applyTransform(imageWrapper, card.layout.image); if (card.source.enabled) { sourceWrapper.style.display = 'block'; sourceText.textContent = card.source.text; applyTransform(sourceWrapper, card.source.layout); } else { sourceWrapper.style.display = 'none'; } }
        function applyTransform(el, layout) { if (el && layout) el.style.transform = `translate(${layout.x}px, ${layout.y}px) scale(${layout.scale}) rotate(${layout.angle}deg)`; }
        function updateScriptStyleControls() { const card = scriptCards.find(c => c.id === selectedCardId); if (!card) return; document.getElementById('st-setting-script-color').value = card.style?.color || '#000000'; document.getElementById('st-setting-script-font').value = card.style?.fontFamily || "'Noto Sans KR', sans-serif"; document.getElementById('st-setting-script-size').value = (card.style?.fontSize || '24px').replace('px',''); }
        function applyScriptStylesToSelectedCard() { const card = scriptCards.find(c => c.id === selectedCardId); if (!card) return; card.style = { color: document.getElementById('st-setting-script-color').value, fontFamily: document.getElementById('st-setting-script-font').value, fontSize: document.getElementById('st-setting-script-size').value + 'px' }; updatePreviewDisplay(); }
        function playBGM(bgmData = globalBGM) { if (bgmData && bgmData.url) { if (bgmPlayer.src !== bgmData.url) bgmPlayer.src = bgmData.url; bgmPlayer.volume = globalBGM.volume; bgmPlayer.currentTime = bgmData.startTime || 0; bgmPlayer.play().catch(e => console.error("BGM Playback Error:", e)); } else { bgmPlayer.pause(); } }
        bgmPlayer.addEventListener('timeupdate', () => { if (!isPlaying) return; if (globalBGM.endTime && bgmPlayer.currentTime >= globalBGM.endTime) { bgmPlayer.currentTime = globalBGM.startTime || 0; } });
        function togglePlay() { isPlaying ? stopPlayback() : startPlayback(); }
        function startPlayback() { deactivateAllInteractive(); const unready = scriptCards.some(c => !c.ttsReady && c.text.trim()); if (unready) return alert('ÏïÑÏßÅ ÏùåÏÑ± ÏÉùÏÑ±Ïù¥ ÏôÑÎ£åÎêòÏßÄ ÏïäÏùÄ Ïä§ÌÅ¨Î¶ΩÌä∏Í∞Ä ÏûàÏäµÎãàÎã§.'); if (scriptCards.length === 0) return; isPlaying = true; playAllBtn.textContent = '‚ùö‚ùö'; playBGM(); playCardByIndex(0); }
        function stopPlayback() { isPlaying = false; clearTimeout(playbackTimeoutId); playAllBtn.textContent = '‚ñ∂'; ttsPlayer.pause(); bgmPlayer.pause(); sfxPlayer.pause(); }
        function playCardByIndex(index) { if (index >= scriptCards.length || !isPlaying) { stopPlayback(); return; } playbackCurrentIndex = index; const card = scriptCards[index]; selectCard(card.id, true); if (card.audioUrl) { ttsPlayer.volume = card.ttsVolume; ttsPlayer.src = card.audioUrl; ttsPlayer.play(); } if (card.sfxUrl) { sfxPlayer.volume = card.sfxVolume; sfxPlayer.src = card.sfxUrl; sfxPlayer.play(); } playbackTimeoutId = setTimeout(() => { if (isPlaying) playCardByIndex(index + 1); }, card.duration * 1000); }
        function setupGptsModal() { addGptsBtn.addEventListener('click', () => { gptsModal.classList.add('visible'); }); function closeModal() { gptsModal.classList.remove('visible'); gptsTextarea.value = ''; } gptsCancelBtn.addEventListener('click', closeModal); gptsModal.addEventListener('click', (e) => { if (e.target === gptsModal) { closeModal(); } }); gptsConfirmBtn.addEventListener('click', () => { const text = gptsTextarea.value.trim(); if (!text) return; const lines = text.split(/\n\s*\n/).filter(line => line.trim() !== ''); lines.forEach(line => { addScriptCard(line.trim()); }); closeModal(); if(lines.length > 0 && scriptCards.length > 0) { const firstNewCardId = scriptCards[scriptCards.length - lines.length].id; selectCard(firstNewCardId); } }); }
        function setupExportButton() { const exportBtn = document.getElementById('st-btn-export-video'); const progressOverlay = document.getElementById('st-export-progress-overlay'); const progressText = document.getElementById('st-export-progress-text'); const progressSubText = document.getElementById('st-export-progress-subtext'); const progressBarInner = document.getElementById('st-export-progress-bar-inner'); const RENDER_WIDTH = 1080; const RENDER_HEIGHT = 1920; const FPS = 30; exportBtn.addEventListener('click', async () => { if (scriptCards.some(c => !c.ttsReady && c.text.trim())) return alert('ÏïÑÏßÅ ÏùåÏÑ± ÏÉùÏÑ±Ïù¥ ÏôÑÎ£åÎêòÏßÄ ÏïäÏùÄ Ïä§ÌÅ¨Î¶ΩÌä∏Í∞Ä ÏûàÏäµÎãàÎã§.'); if (scriptCards.length === 0) return alert('Ï∂úÎ†•Ìï† ÏòÅÏÉÅÏù¥ ÏóÜÏäµÎãàÎã§.'); exportBtn.disabled = true; progressOverlay.style.display = 'flex'; progressText.textContent = 'Ïû•Î©¥ Ïä§ÎÉÖÏÉ∑ Ï§ÄÎπÑ Ï§ë...'; let audioContext, recorder, animationFrameId; const cleanup = () => { if (recorder && recorder.state !== 'inactive') recorder.stop(); if (animationFrameId) cancelAnimationFrame(animationFrameId); if (audioContext) audioContext.close(); progressOverlay.style.display = 'none'; exportBtn.disabled = false; selectCard(scriptCards[0].id); }; try { const sceneSnapshots = []; for (let i = 0; i < scriptCards.length; i++) { progressSubText.textContent = `${i + 1} / ${scriptCards.length} Ïû•Î©¥ Ï∫°Ï≥ê Ï§ë`; selectCard(scriptCards[i].id, true); await new Promise(r => setTimeout(r, 50)); const previewPanelEl = document.getElementById('st-preview-panel'); const snapshotCanvas = await html2canvas(previewPanelEl, { scale: RENDER_WIDTH / previewPanelEl.offsetWidth, useCORS: true, allowTaint: true, backgroundColor: '#ffffff' }); sceneSnapshots.push(snapshotCanvas); } progressText.textContent = 'Ïò§ÎîîÏò§ Ìä∏Îûô Ï≤òÎ¶¨ Ï§ë...'; progressSubText.textContent = 'ÏùåÏÑ± ÌååÏùºÎì§ÏùÑ ÌïòÎÇòÎ°ú Ìï©Ïπ©ÎãàÎã§.'; audioContext = new AudioContext(); const destination = audioContext.createMediaStreamDestination(); const totalDuration = scriptCards.reduce((sum, card) => sum + (card.duration || 0.5), 0); const masterGain = audioContext.createGain(); masterGain.gain.value = 0.8; masterGain.connect(destination); async function analyzeAudio(url) { if (!url) return { buffer: null, trimStart: 0 }; try { const response = await fetch(url); const arrayBuffer = await response.arrayBuffer(); const audioBuffer = await audioContext.decodeAudioData(arrayBuffer.slice(0)); let trimStart = 0; const audioData = audioBuffer.getChannelData(0); for (let i = 0; i < audioData.length; i++) { if (Math.abs(audioData[i]) > 0.01) { trimStart = i / audioBuffer.sampleRate; break; } } return { buffer: audioBuffer, trimStart }; } catch (e) { console.error(`Ïò§ÎîîÏò§ Î∂ÑÏÑù Ïã§Ìå®: ${url}`, e); return { buffer: null, trimStart: 0 }; } } if (globalBGM.url) { try { const { buffer } = await analyzeAudio(globalBGM.url); if (buffer) { const bgmSource = audioContext.createBufferSource(); bgmSource.buffer = buffer; bgmSource.loop = true; const gainNode = audioContext.createGain(); gainNode.gain.value = globalBGM.volume; bgmSource.connect(gainNode).connect(masterGain); bgmSource.start(0, globalBGM.startTime); } } catch (e) { console.error("BGM Î°úÎî© Ïã§Ìå®:", e); } } const audioFilePromises = scriptCards.flatMap((card, index) => { const timeOffset = scriptCards.slice(0, index).reduce((sum, c) => sum + (c.duration || 0.5), 0); const promises = []; if (card.audioUrl) promises.push({ url: card.audioUrl, time: timeOffset, volume: card.ttsVolume, isTTS: true }); if (card.sfxUrl) promises.push({ url: card.sfxUrl, time: timeOffset, volume: card.sfxVolume, isTTS: false }); return promises; }); await Promise.all(audioFilePromises.map(async (audio) => { const { buffer, trimStart } = await analyzeAudio(audio.url); if (buffer) { const source = audioContext.createBufferSource(); source.buffer = buffer; const gainNode = audioContext.createGain(); gainNode.gain.value = audio.volume; source.connect(gainNode).connect(masterGain); source.start(audio.time, audio.isTTS ? trimStart : 0); } })); const canvas = document.getElementById('st-render-canvas'); const ctx = canvas.getContext('2d'); canvas.width = RENDER_WIDTH; canvas.height = RENDER_HEIGHT; const canvasStream = canvas.captureStream(FPS); const combinedStream = new MediaStream([...canvasStream.getVideoTracks(), ...destination.stream.getAudioTracks()]); recorder = new MediaRecorder(combinedStream, { mimeType: 'video/webm;codecs=vp9,opus' }); const chunks = []; recorder.ondataavailable = e => chunks.push(e.data); recorder.onstop = () => { const blob = new Blob(chunks, { type: 'video/webm' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'sunsak-video-1080p.webm'; a.click(); URL.revokeObjectURL(url); cleanup(); }; recorder.start(); progressText.textContent = 'ÌîÑÎ†àÏûÑ Î†åÎçîÎßÅ Ï§ë...'; const renderStartTime = performance.now(); const renderLoop = async () => { const elapsedTime = (performance.now() - renderStartTime) / 1000; if (elapsedTime >= totalDuration) { if(recorder.state === 'recording') recorder.stop(); return; } let timeTally = 0; let currentCardIndex = 0; for(let i = 0; i < scriptCards.length; i++) { timeTally += scriptCards[i].duration || 0.5; if (elapsedTime <= timeTally) { currentCardIndex = i; break; } } const snapshot = sceneSnapshots[currentCardIndex]; if (snapshot) { ctx.clearRect(0, 0, RENDER_WIDTH, RENDER_HEIGHT); ctx.drawImage(snapshot, 0, 0, RENDER_WIDTH, RENDER_HEIGHT); } const progress = Math.min(100, (elapsedTime / totalDuration) * 100); progressSubText.textContent = `${elapsedTime.toFixed(2)}s / ${totalDuration.toFixed(2)}s`; progressBarInner.style.width = `${progress}%`; animationFrameId = requestAnimationFrame(renderLoop); }; animationFrameId = requestAnimationFrame(renderLoop); } catch (error) { console.error('ÏòÅÏÉÅ ÏÉùÏÑ± Ïò§Î•ò:', error); alert(`ÏòÅÏÉÅ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}`); cleanup(); } }); }
        function setupImagePaste() { document.addEventListener('paste', (event) => { if (!selectedCardId) return; const items = (event.clipboardData || window.clipboardData).items; let imageFile = null; for (const item of items) { if (item.type.indexOf('image') === 0) { imageFile = item.getAsFile(); break; } } if (imageFile) { event.preventDefault(); const card = scriptCards.find(c => c.id === selectedCardId); if (!card) return; const reader = new FileReader(); reader.onload = (e) => { card.imageUrl = e.target.result; updatePreviewDisplay(); }; reader.readAsDataURL(imageFile); } }); }
        function initializeInteract() { let previewContent = document.querySelector('.st-preview-content'); interact('.interactive-target').on('tap', (event) => { const target = event.currentTarget; if (activeInteractiveElement === target) return; deactivateAllInteractive(); activeInteractiveElement = target; target.classList.add('interactive-active'); ['top-left', 'top-right', 'bottom-left', 'bottom-right'].forEach(pos => { const handle = document.createElement('div'); handle.className = `resize-handle`; handle.style.top = pos.includes('top') ? '-5px' : ''; handle.style.bottom = pos.includes('bottom') ? '-5px' : ''; handle.style.left = pos.includes('left') ? '-5px' : ''; handle.style.right = pos.includes('right') ? '-5px' : ''; handle.style.cursor = pos === 'top-left' || pos === 'bottom-right' ? 'nwse-resize' : 'nesw-resize'; target.appendChild(handle); }); const rotHandle = document.createElement('div'); rotHandle.className = 'rotation-handle'; rotHandle.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.7594 20.0001C11.5894 20.5301 8.20942 19.5601 5.86942 17.2201C2.59942 13.9501 2.59942 8.55006 5.86942 5.28006C9.13942 2.01006 14.5394 2.01006 17.8094 5.28006C19.7994 7.27006 20.6594 9.87006 20.4794 12.4401" stroke="#333" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/><path d="M15.4297 12.4401L20.4797 12.4401L18.4297 10.3901" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`; target.appendChild(rotHandle); event.preventDefault(); }).on('doubletap', (event) => { const card = scriptCards.find(c => c.id === selectedCardId); if (!card) return; const layoutKey = event.currentTarget.dataset.layoutKey; if (layoutKey === 'source') { const currentText = card.source.text.replace('Ï∂úÏ≤ò:', '').trim(); const newText = prompt('Ï∂úÏ≤ò ÎÇ¥Ïö©ÏùÑ ÏàòÏ†ïÌïòÏÑ∏Ïöî:', currentText); if (newText !== null) { card.source.text = 'Ï∂úÏ≤ò: ' + newText; updatePreviewDisplay(); } } }).draggable({ listeners: { move(event) { const card = scriptCards.find(c => c.id === selectedCardId); if (!card) return; const layoutKey = event.target.dataset.layoutKey; const layout = layoutKey === 'source' ? card.source.layout : card.layout[layoutKey]; layout.x += event.dx; layout.y += event.dy; applyTransform(event.target, layout); } } }).resizable({ edges: { top: true, left: true, bottom: true, right: true }, listeners: { move(event) { const card = scriptCards.find(c => c.id === selectedCardId); if (!card) return; const layoutKey = event.target.dataset.layoutKey; const layout = layoutKey === 'source' ? card.source.layout : card.layout[layoutKey]; const oldWidth = event.target.getBoundingClientRect().width; layout.x += event.deltaRect.left; layout.y += event.deltaRect.top; const newWidth = event.rect.width; if (oldWidth > 0) layout.scale *= newWidth / oldWidth; applyTransform(event.target, layout); } }, modifiers: [ interact.modifiers.aspectRatio({ ratio: 'preserve' }) ], inertia: true }); interact('.rotation-handle').draggable({ onmove: (event) => { const parent = event.target.parentNode; if (!parent) return; const card = scriptCards.find(c => c.id === selectedCardId); if (!card) return; const layoutKey = parent.dataset.layoutKey; const layout = layoutKey === 'source' ? card.source.layout : card.layout[layoutKey]; const rect = parent.getBoundingClientRect(); const centerX = rect.left + rect.width / 2; const centerY = rect.top + rect.height / 2; const angle = Math.atan2(event.clientY - centerY, event.clientX - centerX); layout.angle = angle * (180 / Math.PI) + 90; applyTransform(parent, layout); }}); document.body.addEventListener('click', (e) => { if (previewContent.contains(e.target) && !e.target.closest('.interactive-target')) { deactivateAllInteractive(); } }); }
        function deactivateAllInteractive() { document.querySelectorAll('.interactive-target.interactive-active').forEach(el => { el.classList.remove('interactive-active'); el.querySelectorAll('.resize-handle, .rotation-handle').forEach(h => h.remove()); }); activeInteractiveElement = null; }
        
        function initialize() {
            renderControls();
            updatePreviewDisplay();
            addCardBtn.addEventListener('click', () => addScriptCard());
            newProjectBtn.addEventListener('click', () => { if(confirm('Ï†ïÎßêÎ°ú ÏÉà ÌîÑÎ°úÏ†ùÌä∏Î•º ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå? Î™®Îì† ÏûëÏóÖ ÎÇ¥Ïö©Ïù¥ ÏÇ¨ÎùºÏßëÎãàÎã§.')) { location.reload(); } });
            playAllBtn.addEventListener('click', togglePlay);
            setupGptsModal();
            setupExportButton();
            setupImagePaste();
            new Sortable(cardContainer, { animation: 150, handle: '.st-card-drag-handle', onEnd: function(evt) { const { oldIndex, newIndex } = evt; const [movedItem] = scriptCards.splice(oldIndex, 1); scriptCards.splice(newIndex, 0, movedItem); updateCardNumbers(); } });
            initializeInteract();
            addScriptCard('SunsakToolÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!');
        }
        
        initialize();
    });
    </script>
</body>
</html>
