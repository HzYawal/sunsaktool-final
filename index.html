<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SunsakTool (ìˆœì‚­íˆ´)</title>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=IBM+Plex+Sans+KR:wght@400;700&family=Gowun+Dodum&family=Gowun+Batang&family=Nanum+Myeongjo:wght@400;700;800&family=Do+Hyeon&family=Black+Han+Sans&family=Gaegu:wght@400;700&family=Hi+Melody&family=Noto+Serif+KR:wght@400;700;900&family=Dokdo&display=swap');
        @font-face { font-family: 'Pretendard'; src: url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff'); font-weight: 400; }
        @font-face { font-family: 'Spoqa Han Sans Neo'; src: url('https://cdn.jsdelivr.net/gh/spoqa/spoqa-han-sans@latest/Subset/SpoqaHanSansNeo/SpoqaHanSansNeo-Regular.woff2') format('woff2'); font-weight: 400; }
        @font-face { font-family: 'GmarketSans'; src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansBold.woff') format('woff'); }
        :root { --st-accent-color: #e82c43; --st-bg-color: #1e1e1e; --st-panel-color: #2a2a2a; --st-border-color: #383838; --st-text-color: #e0e0e0; --st-subtext-color: #aaa; --st-interact-color: #4a90e2;}
        * { box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--st-bg-color); color: var(--st-text-color); display: flex; height: 100vh; margin: 0; overflow: hidden; -webkit-font-smoothing: antialiased; }
        body.interaction-active { user-select: none; -webkit-user-select: none; }
        .st-panel { height: 100vh; display: flex; flex-direction: column; }
        .st-sidebar { width: 280px; background-color: var(--st-panel-color); padding: 20px; border-right: 1px solid var(--st-border-color); overflow-y: auto;}
        .st-main-container { flex-grow: 1; display: flex; flex-direction: column; }
        .st-top-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background-color: var(--st-panel-color); border-bottom: 1px solid var(--st-border-color); flex-shrink: 0; height: 50px;}
        .st-logo { font-family: 'GmarketSans', sans-serif; font-weight: bold; }
        .st-main-content { display: flex; flex-grow: 1; overflow: hidden; }
        .st-preview-area { flex-basis: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .st-editor-area { flex-grow: 1; border-left: 1px solid var(--st-border-color); overflow-y: auto; padding: 20px; }
        button { background-color: var(--st-accent-color); color: #fff; font-weight: bold; cursor: pointer; border: none; border-radius: 4px; padding: 8px 12px; }
        button:disabled { background-color: #555; cursor: not-allowed; }
        .st-preview-panel { width: 100%; max-width: 380px; aspect-ratio: 9 / 16; background-color: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.2); display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .st-preview-header { position:relative; display: flex; align-items: center; justify-content: center; font-family: 'GmarketSans', sans-serif; color: white; font-weight: bold; flex-shrink: 0; height: 65px; padding: 0 15px; overflow: hidden; }
        .header-icon { position: absolute; left: 15px; display: flex; align-items: center; }
        .header-title { flex-grow: 1; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 0 45px; }
        .header-logo-container { position: absolute; right: 15px; display: flex; align-items: center; }
        .header-icon svg { width: 24px; height: 24px; }
        .header-logo { border-radius: 50%; object-fit: cover; background-color: #eee; }
        .st-preview-content { padding: 10px; color: black; flex-grow: 1; display: flex; flex-direction: column; background-color: white; overflow: hidden; position: relative; }
        .st-project-info { font-size: 13px; color: #555; margin: 0 0 16px 0; border-bottom: 1px solid #eee; padding-bottom: 16px; flex-shrink: 0; }
        .st-project-info .title { font-size: 22px; color: black; font-weight: bold; margin-bottom: 5px; }
        .st-script-display { flex-grow: 1; position: relative; }
        .interactive-target { position: relative; width: 100%; text-align: center; cursor: move; }
        #st-preview-text-container-wrapper { margin-bottom: 8px; z-index: 10; }
        #st-preview-media-container-wrapper { flex-grow: 1; display: flex; align-items: center; justify-content: center; margin-top: 8px; }
        #st-preview-image, #st-preview-video { max-width: 100%; max-height: 100%; object-fit: contain; }
        #st-preview-source-container-wrapper { position: absolute; bottom: 5px; right: 5px; width: auto; max-width: 95%; font-size: 10px; color: #888; text-align: right; }
        .interactive-target.interactive-active { outline: 2px dashed var(--st-interact-color); z-index: 100; }
        .resize-handle { position: absolute; width: 12px; height: 12px; background: white; border-radius: 50%; border: 2px solid var(--st-interact-color); z-index: 101; display: none; }
        .rotation-handle { position: absolute; bottom: -35px; left: 50%; transform: translateX(-50%); width: 24px; height: 24px; background-color: white; border-radius: 50%; border: 1px solid #ccc; cursor: grab; display: none; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 102; }
        .rotation-handle:active { cursor: grabbing; }
        .interactive-active .resize-handle, .interactive-active .rotation-handle { display: flex; }
        #st-preview-text, #st-preview-source-text { width: 100%; white-space: pre-wrap; }
        .st-timeline-controls { width: 100%; max-width: 380px; display: flex; align-items: center; gap: 10px; margin-top: 15px;}
        .st-play-all-btn { background: none; font-size: 24px; padding: 0;}
        #st-timeline-slider, .st-volume-slider, #st-setting-header-logo-size { flex-grow: 1; margin: 0; }
        .st-editor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .st-card { background-color: var(--st-panel-color); border: 2px solid transparent; padding: 15px; margin-top: 15px; border-radius: 4px; cursor: pointer; position: relative; }
        .st-card.active { border-color: var(--st-accent-color); }
        .st-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .st-card-drag-handle { cursor: grab; }
        .st-card-number { font-weight: bold; font-size: 18px; }
        .st-editor-tip { font-size: 13px; color: var(--st-subtext-color); background-color: #252525; padding: 8px; border-radius: 4px; text-align: center; }
        .st-script-editor { width: 100%; min-height: 60px; background-color: #333; border: 1px solid var(--st-border-color); color: var(--st-text-color); border-radius: 4px; padding: 8px; outline: none; white-space: pre-wrap; }
        .st-script-editor .script-segment { cursor: grab; padding: 2px 0; }
        .st-script-editor .script-segment:active { cursor: grabbing; }
        .st-script-editor .script-segment.sortable-ghost { opacity: 0.4; background: #444; }
        .preview-text-segment { visibility: hidden; }
        .preview-text-segment.highlight { visibility: visible; }
        .st-card-footer { margin-top: 10px; display: flex; flex-direction: column; gap: 10px; }
        .st-card-footer .footer-row { display: flex; align-items: center; gap: 10px; font-size: 13px; flex-wrap: wrap; }
        .st-card-footer .st-duration-label { cursor: pointer; text-decoration: underline; }
        .st-card-footer .st-duration-input { width: 60px; padding: 2px 4px; }
        .st-card-footer .st-volume-slider { width: 70px; }
        input[type="file"] { display: none; }
        .st-action-btn { background: none; border:none; color: var(--st-subtext-color); text-decoration: underline; cursor: pointer; padding: 0; font-size: 13px; }
        .st-play-clip-btn { font-size: 18px; background: none; padding: 0 5px; cursor: pointer; border: none; color: var(--st-text-color); }
        .st-play-clip-btn:disabled { color: #555; cursor: not-allowed; }
        .st-card-loading { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); color: white; display: flex; justify-content: center; align-items: center; z-index: 10; border-radius: 4px; font-weight: bold; }
        .st-accordion-header { padding: 12px 0; cursor: pointer; border-bottom: 1px solid var(--st-border-color); font-weight: bold; }
        .st-accordion-content { padding: 15px 0; display: none; }
        .st-accordion-item.active .st-accordion-content { display: block; }
        .st-control-group { margin-bottom: 15px; }
        .st-control-group h4 { margin-top: 0; margin-bottom: 10px; color: var(--st-subtext-color); border-bottom: 1px solid var(--st-border-color); padding-bottom: 8px; }
        input, select { width: 100%; padding: 8px; background-color: #1e1e1e; border: 1px solid var(--st-border-color); color: var(--st-text-color); }
        .st-flex-group { display: flex; gap: 10px; }
        .st-modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .st-modal-overlay.visible { display: flex; }
        .st-modal-dialog { background-color: var(--st-panel-color); padding: 24px; border-radius: 8px; width: 90%; max-width: 600px; border: 1px solid var(--st-border-color); }
        .st-modal-dialog .st-modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 24px; }
        #st-waveform-container { width: 100%; height: 128px; background-color: #1e1e1e; }
        #st-waveform-loading { text-align: center; padding: 40px; color: var(--st-subtext-color); }
        #st-export-progress-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; color: white; display: none; flex-direction: column; justify-content: center; align-items: center; font-size: 24px; }
        #st-export-progress-text { font-weight: bold; margin-bottom: 10px; }
        #st-export-progress-subtext { font-size: 16px; color: var(--st-subtext-color); }
        #st-export-progress-bar { width: 80%; max-width: 400px; height: 20px; background: #555; margin-top: 20px; border-radius: 10px; overflow: hidden; }
        #st-export-progress-bar-inner { width: 0%; height: 100%; background: var(--st-accent-color); transition: width 0.1s linear; }
        .st-app-footer { position: fixed; bottom: 0; left: 0; width: 100%; text-align: center; font-size: 12px; padding: 5px; background-color: var(--st-bg-color); color: var(--st-subtext-color); z-index: 1; }
        input[type="range"] { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: #555; border-radius: 5px; outline: none; padding: 0; margin: auto 0; cursor: pointer; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: var(--st-accent-color); border-radius: 50%; border: 2px solid #fff; margin-top: -5px; }
        input[type="range"]::-moz-range-track { width: 100%; height: 6px; background: #555; border-radius: 5px; border: none; }
        input[type="range"]::-moz-range-thumb { width: 16px; height: 16px; background: var(--st-accent-color); border-radius: 50%; border: 2px solid #fff; }
        .animated { animation-fill-mode: forwards !important; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } } .anim-fade-in { animation-name: fadeIn; }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } } .anim-fade-out { animation-name: fadeOut; }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } } .anim-zoom-in { animation-name: zoomIn; }
        @keyframes zoomOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.5); } } .anim-zoom-out { animation-name: zoomOut; }
        @keyframes slideInLeft { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } } .anim-slide-in-left { animation-name: slideInLeft; }
        @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } } .anim-slide-out-right { animation-name: slideOutRight; }
        @keyframes slideInUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } } .anim-slide-in-up { animation-name: slideInUp; }
        @keyframes slideOutDown { from { transform: translateY(0); opacity: 1; } to { transform: translateY(100%); opacity: 0; } } .anim-slide-out-down { animation-name: slideOutDown; }
        #st-sequence-menu { position: fixed; z-index: 1001; background-color: var(--st-panel-color); border: 1px solid var(--st-border-color); border-radius: 5px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); list-style: none; padding: 5px 0; margin: 0; font-size: 14px; }
        #st-sequence-menu li { padding: 8px 15px; cursor: pointer; }
        #st-sequence-menu li:hover { background-color: var(--st-accent-color); color: white; }
        #st-sequence-menu hr { border: none; border-top: 1px solid var(--st-border-color); margin: 5px 0; }
    </style>
</head>
<body>
    <div class="st-panel st-sidebar" id="st-sidebar-container">
        <div id="st-global-settings-panel"></div>
        <div id="st-animation-settings-panel" style="display: none;"></div>
    </div>
    <div class="st-main-container">
        <div class="st-top-header">
            <div class="st-logo">SunsakTool</div>
            <button id="st-btn-export-video">ğŸ¬ ì˜ìƒ ì €ì¥</button>
        </div>
        <div class="st-main-content">
            <div class="st-panel st-preview-area">
                <div class="st-preview-panel" id="st-preview-panel">
                     <div class="st-preview-header"><div class="header-icon"></div><div class="header-title"></div><div class="header-logo-container"><img class="header-logo"></div></div>
                     <div class="st-preview-content">
                         <div class="st-project-info"><div class="title"></div><span></span></div>
                         <div class="st-script-display">
                            <div id="st-preview-text-container-wrapper" class="interactive-target" data-layout-key="text"><div id="st-preview-text"></div></div>
                            <div id="st-preview-media-container-wrapper" class="interactive-target" data-layout-key="media">
                                <img id="st-preview-image" style="display: none;">
                                <video id="st-preview-video" style="display: none;" muted playsinline></video>
                            </div>
                            <div id="st-preview-source-container-wrapper" class="interactive-target" data-layout-key="source" style="display: none;"><div id="st-preview-source-text"></div></div>
                         </div>
                     </div>
                </div>
                <div class="st-timeline-controls">
                    <button class="st-play-all-btn" id="st-btn-play-all">â–¶</button>
                    <input type="range" id="st-timeline-slider" value="0" step="0.1">
                </div>
            </div>
            <div class="st-panel st-editor-area">
                <div class="st-editor-header">
                    <h3>ìŠ¤í¬ë¦½íŠ¸ & íƒ€ì„ë¼ì¸</h3>
                    <div class="button-group">
                        <button id="st-btn-add-project" style="background-color: #555;">+ ìƒˆ í”„ë¡œì íŠ¸</button>
                        <button id="st-btn-add-gpts" style="background-color: #3e3e3e;">âœ¨ AI ëŒ€ë³¸ ìƒì„±</button>
                        <button id="st-btn-add-card">+ ìˆ˜ë™ ì¶”ê°€</button>
                    </div>
                </div>
                <div class="st-editor-tip">ğŸ’¡ Tip: ìŠ¤í¬ë¦½íŠ¸ ì¤„ì„ ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œë¥¼ ë°”ê¾¸ê±°ë‚˜, í…ìŠ¤íŠ¸ ì„ íƒ í›„ ìˆœì„œ ì§€ì • ë©”ë‰´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”!</div>
                <div id="st-card-container"></div>
            </div>
        </div>
    </div>
    <div class="st-app-footer">Pro-Tip: ì›¹ì˜ ì´ë¯¸ì§€ë¥¼ ë³µì‚¬(Ctrl+C)í•œ í›„, ì¹´ë“œë¥¼ í´ë¦­í•˜ê³  ë¶™ì—¬ë„£ê¸°(Ctrl+V) í•´ë³´ì„¸ìš”!</div>
    
    <ul id="st-sequence-menu" style="display: none;"></ul>
    <div id="st-modal-gpts" class="st-modal-overlay"> <div class="st-modal-dialog"> <h2>AI ëŒ€ë³¸ ë¶™ì—¬ë„£ê¸°</h2> <p>AI íˆ´(ChatGPT, Claude ë“±)ì—ì„œ ìƒì„±ëœ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ë¹ˆ ì¤„ë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í•œë²ˆì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p> <textarea id="st-gpts-textarea" placeholder="ì—¬ê¸°ì— AI ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea> <div class="st-modal-actions"> <button id="st-btn-gpts-cancel" class="cancel">ì·¨ì†Œ</button> <button id="st-btn-gpts-confirm">í™•ì¸</button> </div> </div> </div>
    <div id="st-modal-bgm" class="st-modal-overlay"> <div class="st-modal-dialog"> <h2>BGM êµ¬ê°„ ì„¤ì •</h2> <p>ì˜¤ë””ì˜¤ íŒŒí˜• ìœ„ì—ì„œ ì›í•˜ëŠ” êµ¬ê°„ì„ ë“œë˜ê·¸í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”.</p> <div id="st-waveform-container"> <div id="st-waveform-loading">BGM ë¡œë”© ì¤‘...</div> </div> <div class="st-waveform-controls"> <button id="st-btn-bgm-play-pause">ì¬ìƒ/ì¼ì‹œì •ì§€</button> <button id="st-btn-bgm-play-region">ì„ íƒ êµ¬ê°„ ë¯¸ë¦¬ë“£ê¸°</button> <span id="st-bgm-time-display">0.00s - 0.00s</span> </div> <div class="st-modal-actions"> <button id="st-btn-bgm-cancel" class="cancel">ì·¨ì†Œ</button> <button id="st-btn-bgm-confirm">í™•ì¸</button> </div> </div> </div>
    <div id="st-export-progress-overlay">
        <div id="st-export-progress-text">ì˜ìƒ ìƒì„± ì¤‘...</div>
        <div id="st-export-progress-subtext"></div>
        <div id="st-export-progress-bar"><div id="st-export-progress-bar-inner"></div></div>
    </div>
    <canvas id="st-render-canvas" style="display: none;"></canvas>
    <audio id="st-tts-player" style="display:none;"></audio>
    <audio id="st-bgm-player" style="display:none;" loop></audio>
    <audio id="st-sfx-player" style="display:none;"></audio>
    <input type="file" id="st-sfx-file-upload" accept="audio/*" style="display: none;">
    <input type="file" id="st-bgm-file-upload" accept="audio/*" style="display: none;">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/6.4.0/wavesurfer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/6.4.0/plugin/wavesurfer.regions.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ANIMATION_LIST = [ { name: 'ì—†ìŒ', value: 'none' }, { name: 'ë‚˜íƒ€ë‚˜ê¸° (Fade In)', value: 'fade-in' }, { name: 'ì‚¬ë¼ì§€ê¸° (Fade Out)', value: 'fade-out' }, { name: 'í™•ëŒ€í•˜ë©° ë‚˜íƒ€ë‚˜ê¸° (Zoom In)', value: 'zoom-in' }, { name: 'ì¶•ì†Œí•˜ë©° ì‚¬ë¼ì§€ê¸° (Zoom Out)', value: 'zoom-out' }, { name: 'ì™¼ìª½ì—ì„œ ìŠ¬ë¼ì´ë“œ (Slide In Left)', value: 'slide-in-left' }, { name: 'ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ (Slide Out Right)', value: 'slide-out-right' }, { name: 'ìœ„ë¡œ ìŠ¬ë¼ì´ë“œ (Slide In Up)', value: 'slide-in-up' }, { name: 'ì•„ë˜ë¡œ ìŠ¬ë¼ì´ë“œ (Slide Out Down)', value: 'slide-out-down' }, ];
            const FONT_LIST = [ { name: 'í”„ë¦¬í…ë‹¤ë“œ (ë³¸ë¬¸ìš© ì¶”ì²œ)', value: 'Pretendard' }, { name: 'Noto Sans KR (ê¸°ë³¸ ê³ ë”•)', value: "'Noto Sans KR', sans-serif" }, { name: 'Gë§ˆì¼“ ì‚°ìŠ¤ (ê°œì„±ìˆëŠ” ì œëª©)', value: 'GmarketSans' }, { name: 'IBM Plex Sans KR (ëª¨ë˜í•œ ê³ ë”•)', value: "'IBM Plex Sans KR', sans-serif" }, { name: 'Do Hyeon (ë ˆíŠ¸ë¡œ ì œëª©)', value: "'Do Hyeon', sans-serif" }, { name: 'ë‚˜ëˆ”ëª…ì¡° (ê°ì„±ì ì¸ ë³¸ë¬¸)', value: "'Nanum Myeongjo', serif" }, { name: 'ê³ ìš´ ë°”íƒ• (ë¶€ë“œëŸ¬ìš´ ëª…ì¡°)', value: "'Gowun Batang', serif" }, { name: 'Black Han Sans (ê°•ë ¥í•œ ì œëª©)', value: "'Black Han Sans', sans-serif" }, { name: 'ê°œêµ¬ (ê·€ì—¬ìš´ ì†ê¸€ì”¨)', value: "'Gaegu', cursive" }, { name: 'Hi Melody (ì•„ê¸°ìê¸° ì†ê¸€ì”¨)', value: "'Hi Melody', cursive" }, { name: 'Noto Serif KR (ì •ê°ˆí•œ ëª…ì¡°)', value: "'Noto Serif KR', serif" }, { name: 'ìŠ¤í¬ì¹´ í•œ ì‚°ìŠ¤ ë„¤ì˜¤ (ê¹”ë”í•œ ë³¸ë¬¸)', value: "'Spoqa Han Sans Neo', sans-serif" }, { name: 'ë…ë„ (ê±°ì¹œ ë¶“ê¸€ì”¨)', value: "'Dokdo', cursive" }, ];
            const BGM_LIST = [ { name: 'ì„ íƒ ì•ˆí•¨', url: '' }, { name: 'big-cafe', url: 'https://sunsaktool-final.netlify.app/big-cafe.mp3' }, { name: 'blue-jacket', url: 'https://sunsaktool-final.netlify.app/blue-jacket.mp3' }, { name: 'cute-puppy', url: 'https://sunsaktool-final.netlify.app/cute-puppy.mp3' }, { name: 'laughter-in-the-breeze', url: 'https://sunsaktool-final.netlify.app/laughter-in-the-breeze-_happy_.mp3' }, { name: 'murder-in-my-mind', url: 'https://sunsaktool-final.netlify.app/murder-in-my-mind.mp3' }, { name: 'smiley-composure', url: 'https://sunsaktool-final.netlify.app/smiley-composure.mp3' }, { name: 'spider', url: 'https://sunsaktool-final.netlify.app/spider.mp3' }, { name: 'white-color', url: 'https://sunsaktool-final.netlify.app/white-color.mp3' } ];
            let SFX_LIST = [{ name: "íš¨ê³¼ìŒ ëª©ë¡ ë¡œë”© ì¤‘...", url: "" }];
            let recentlyUsedSfx = [];
            let sfxUploadTargetCardId = null;
            let globalBGM = { url: null, volume: 0.3, startTime: 0, endTime: null };
            let projectSettings = { 
                header: { text: 'ì±„ë„ ì´ë¦„', backgroundColor: '#e82c43', color: '#ffffff', fontFamily: 'GmarketSans', fontSize: 24, icon: 'none', logo: { url: null, size: 40 } }, 
                project: { title: 'ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', author: 'ã…‡ã…‡', views: 0, titleColor: '#000000', metaColor: '#555555' },
                defaultStyle: { color: '#000000', fontFamily: "'Noto Sans KR', sans-serif", fontSize: '24', lineHeight: '1.5' }
            };
            let scriptCards = [];
            let isPlaying = false;
            let ttsCache = new Map();
            let playbackCurrentIndex = 0;
            let selectedCardId = null;
            let activeInteractiveElement = null;
            let playbackTimeoutId = null;
            let currentSelectionContext = null;
            const cardContainer = document.getElementById('st-card-container');
            const playAllBtn = document.getElementById('st-btn-play-all');
            const timelineSlider = document.getElementById('st-timeline-slider');
            const ttsPlayer = document.getElementById('st-tts-player');
            const bgmPlayer = document.getElementById('st-bgm-player');
            const sfxPlayer = document.getElementById('st-sfx-player'); 
            const globalSettingsPanel = document.getElementById('st-global-settings-panel');
            const animationSettingsPanel = document.getElementById('st-animation-settings-panel');
            const addCardBtn = document.getElementById('st-btn-add-card');
            const addGptsBtn = document.getElementById('st-btn-add-gpts');
            const newProjectBtn = document.getElementById('st-btn-add-project');
            const gptsModal = document.getElementById('st-modal-gpts');
            const gptsCancelBtn = document.getElementById('st-btn-gpts-cancel');
            const gptsConfirmBtn = document.getElementById('st-btn-gpts-confirm');
            const gptsTextarea = document.getElementById('st-gpts-textarea');
            const sfxFileInput = document.getElementById('st-sfx-file-upload');
            const bgmFileInput = document.getElementById('st-bgm-file-upload');
            const sequenceMenu = document.getElementById('st-sequence-menu');
            let wavesurfer = null;
            let activeRegion = null;
            let bgmEditorContext = { onConfirm: null, onCancel: null };
            
            function initializeBgmEditor() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function openBgmEditor(url, callbacks) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function closeBgmEditor() { /* ì´ì „ê³¼ ë™ì¼ */ }
            const debounce = (callback, delay) => { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => callback(...args), delay); }; };
            const getAudioDuration = (url) => new Promise(resolve => { const audio = new Audio(); audio.onloadedmetadata = () => resolve(audio.duration); audio.onerror = () => resolve(0.5); audio.src = url; });
            async function fetchTTS(text, cardId) { text = text.trim(); if (!text) return null; const cacheKey = text; if (ttsCache.has(cacheKey)) return ttsCache.get(cacheKey); showLoadingOnCard(cardId, true, 'ì„œë²„ì— ìš”ì²­ ì¤‘...'); try { const response = await fetch('/.netlify/functions/create-tts', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ text: text }) }); if (!response.ok) { const errorResult = await response.json(); throw new Error(`[${response.status}] ${errorResult.error || 'ì„œë²„ ìš”ì²­ ì‹¤íŒ¨'}`); } const result = await response.json(); const audioUrl = result.audioUrl; const duration = await getAudioDuration(audioUrl); const ttsData = { audioUrl, duration }; ttsCache.set(cacheKey, ttsData); return ttsData; } catch (error) { console.error('TTS ìƒì„± ì˜¤ë¥˜:', error); alert(`ìŒì„± ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`); return null; } finally { showLoadingOnCard(cardId, false); } }
            
            function renderGlobalControls() {
                const fontOptions = FONT_LIST.map(font => `<option value="${font.value}" ${projectSettings.defaultStyle.fontFamily === font.value ? 'selected' : ''}>${font.name}</option>`).join('');
                const bgmOptions = BGM_LIST.map(bgm => `<option value="${bgm.url}">${bgm.name}</option>`).join('');
                globalSettingsPanel.innerHTML = `<div class="st-accordion-item active"><div class="st-accordion-header">ì˜ìƒ ì„¤ì •</div><div class="st-accordion-content"><div class="st-control-group"><h4>ìƒë‹¨ í—¤ë”</h4><label>í—¤ë” í…ìŠ¤íŠ¸</label><input type="text" id="st-setting-header-text" value="${projectSettings.header.text}"><div class="st-flex-group" style="margin-top: 8px;"><div><label>ë°°ê²½ ìƒ‰ìƒ</label><input type="color" id="st-setting-header-bg" value="${projectSettings.header.backgroundColor}"></div><div><label>ê¸€ì ìƒ‰ìƒ</label><input type="color" id="st-setting-header-color" value="${projectSettings.header.color}"></div></div><div class="st-flex-group" style="margin-top: 8px;"><div><label>í°íŠ¸</label><select id="st-setting-header-font">${fontOptions}</select></div><div><label>í¬ê¸°</label><input type="number" id="st-setting-header-size" value="${projectSettings.header.fontSize}"></div></div><div style="margin-top: 8px;"><label>ì™¼ìª½ ì•„ì´ì½˜</label><select id="st-setting-header-icon"><option value="none">ì—†ìŒ</option><option value="back">ë’¤ë¡œê°€ê¸°</option><option value="menu">ë©”ë‰´</option></select></div><div style="margin-top: 8px;"><label>ì˜¤ë¥¸ìª½ ë¡œê³ </label><div class="st-flex-group"><button id="st-btn-header-logo" style="width: auto; flex-grow: 1;">ë¡œê³  ì¶”ê°€/ë³€ê²½</button><input type="file" id="st-header-logo-file" accept="image/*" style="display:none;"></div><label style="margin-top: 4px; display: block;">ë¡œê³  í¬ê¸°: <span id="st-header-logo-size-label">${projectSettings.header.logo.size}</span>px</label><input type="range" id="st-setting-header-logo-size" min="20" max="60" value="${projectSettings.header.logo.size}"></div></div><div class="st-control-group"><h4>ì½˜í…ì¸  ì •ë³´</h4><label>í”„ë¡œì íŠ¸ ì œëª©</label><input type="text" id="st-setting-project-title" value="${projectSettings.project.title}"><div style="margin-top: 8px;"><label>ì‘ì„±ì</label><input type="text" id="st-setting-project-author" value="${projectSettings.project.author}"></div><div style="margin-top: 8px;"><label>ì¡°íšŒìˆ˜</label><input type="number" id="st-setting-project-views" value="${projectSettings.project.views}"></div><div class="st-flex-group" style="margin-top: 8px;"><div><label>ì œëª© ìƒ‰ìƒ</label><input type="color" id="st-setting-title-color" value="${projectSettings.project.titleColor}"></div><div><label>ì •ë³´ ìƒ‰ìƒ</label><input type="color" id="st-setting-meta-color" value="${projectSettings.project.metaColor}"></div></div><hr style="border-color: var(--st-border-color); margin: 15px 0;"><label>ê¸°ë³¸ ìŠ¤í¬ë¦½íŠ¸ ìŠ¤íƒ€ì¼</label><div class="st-flex-group" style="margin-top: 8px;"><div><label>í°íŠ¸</label><select id="st-setting-script-font">${fontOptions}</select></div><div><label>í¬ê¸°</label><input type="number" id="st-setting-script-size" value="24"></div></div><div style="margin-top: 8px;"><label>ìƒ‰ìƒ</label><input type="color" id="st-setting-script-color" value="#000000"></div><div style="margin-top: 8px;"><label>ì¤„ ê°„ê²©</label><input type="range" id="st-setting-line-height" min="1" max="2.5" step="0.1" value="1.5"></div></div><div class="st-control-group"><h4>ë°°ê²½ìŒì•…</h4><label>ì „ì²´ BGM ì„ íƒ</label><select id="st-setting-global-bgm">${bgmOptions}</select><button id="st-btn-upload-bgm" style="width:100%; margin-top: 8px; background-color: #3e3e3e;">ë‚´ BGM ì—…ë¡œë“œ</button><div style="margin-top: 8px;"><label>BGM ë³¼ë¥¨</label><input type="range" id="st-setting-global-bgm-volume" min="0" max="1" step="0.01" value="${globalBGM.volume}"></div></div></div></div>`;
                globalSettingsPanel.querySelector('.st-accordion-header').addEventListener('click', (e) => e.currentTarget.parentElement.classList.toggle('active'));
            }
            function renderAnimationControls(element) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function showGlobalSettingsPanel() { globalSettingsPanel.style.display = 'block'; animationSettingsPanel.style.display = 'none'; }
            function showAnimationPanel(element) { globalSettingsPanel.style.display = 'none'; animationSettingsPanel.style.display = 'block'; renderAnimationControls(element); }
            function updateProjectSettings() {
                projectSettings.header.text = document.getElementById('st-setting-header-text').value;
                projectSettings.header.backgroundColor = document.getElementById('st-setting-header-bg').value;
                projectSettings.header.color = document.getElementById('st-setting-header-color').value;
                projectSettings.header.fontFamily = document.getElementById('st-setting-header-font').value;
                projectSettings.header.fontSize = document.getElementById('st-setting-header-size').value;
                projectSettings.header.icon = document.getElementById('st-setting-header-icon').value;
                projectSettings.project.title = document.getElementById('st-setting-project-title').value;
                projectSettings.project.author = document.getElementById('st-setting-project-author').value;
                projectSettings.project.views = document.getElementById('st-setting-project-views').value;
                projectSettings.project.titleColor = document.getElementById('st-setting-title-color').value;
                projectSettings.project.metaColor = document.getElementById('st-setting-meta-color').value;
                projectSettings.defaultStyle.color = document.getElementById('st-setting-script-color').value;
                projectSettings.defaultStyle.fontFamily = document.getElementById('st-setting-script-font').value;
                projectSettings.defaultStyle.fontSize = document.getElementById('st-setting-script-size').value;
                projectSettings.defaultStyle.lineHeight = document.getElementById('st-setting-line-height').value;
                
                applyScriptStylesToSelectedCard();
                updatePreviewDisplay();
            }
            function getGroupKey(name) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function generateSfxOptions() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function addScriptCard(text = '') {
                const cardId = `card-${Date.now()}-${Math.floor(Math.random() * 10000)}`;
                const cardData = {
                    id: cardId, text, segments: [], animationSequence: [], duration: 0.5, ttsDuration: 0.5, isDurationManual: false,
                    media: { url: null, type: null },
                    style: { ...projectSettings.defaultStyle, fontSize: projectSettings.defaultStyle.fontSize + 'px' }, // fontSizeì— px ì¶”ê°€
                    audioUrl: null, ttsReady: false, ttsVolume: 0.8, sfxUrl: null, sfxVolume: 0.8,
                    source: { enabled: false, text: 'ì¶œì²˜:', layout: { x: 0, y: 0, scale: 1, angle: 0 } },
                    layout: { text: { x: 0, y: 0, scale: 1, angle: 0 }, media: { x: 0, y: 0, scale: 1, angle: 0 } },
                    animations: { text: { in: { name: 'none', duration: 0.3 }, out: { name: 'none', duration: 0.3 } }, media: { in: { name: 'none', duration: 0.3 }, out: { name: 'none', duration: 0.3 } }, source: { in: { name: 'none', duration: 0.3 }, out: { name: 'none', duration: 0.3 } } }
                };
                scriptCards.push(cardData);
                const cardEl = createCardElement(cardData);
                cardContainer.appendChild(cardEl);
                bindCardEvents(cardId);
                const editor = cardEl.querySelector('.st-script-editor');
                renderSegmentsInEditor(editor, cardData.text);
                const debouncedFetch = getDebouncedFetchAndUpdate();
                debouncedFetch(cardId);
                if (!selectedCardId) selectCard(cardId);
                updateCardNumbers();
                updateCardUI(cardId);
            }
            function createCardElement(cardData) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function renderSegmentsInEditor(editorEl, text) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function getDebouncedFetchAndUpdate() { return debounce(async (cardId) => { const cardData = scriptCards.find(c => c.id === cardId); if (!cardData) return; const editor = document.querySelector(`.st-card[data-id="${cardId}"] .st-script-editor`); if (!editor) return; if (editor.children.length === 0 && editor.textContent) { const p = document.createElement('p'); p.className = 'script-segment'; p.textContent = editor.textContent; editor.innerHTML = ''; editor.appendChild(p); } const allLines = Array.from(editor.children).map(child => child.textContent.trim()); cardData.text = allLines.join('\n'); let textForTTS, segmentsForTiming; if (cardData.animationSequence && cardData.animationSequence.length > 0) { const sequencedLines = cardData.animationSequence; const remainingLines = allLines.filter(line => line && !sequencedLines.includes(line)); segmentsForTiming = [...sequencedLines, ...remainingLines]; textForTTS = segmentsForTiming.join(' '); } else { segmentsForTiming = allLines.filter(line => line); textForTTS = segmentsForTiming.join(' '); } if (!textForTTS) { cardData.ttsReady = false; cardData.duration = 0.5; cardData.ttsDuration = 0.5; cardData.segments = []; updateCardUI(cardId); updateTotalDuration(); updatePreviewDisplay(); return; } const ttsData = await fetchTTS(textForTTS, cardId); if (ttsData && cardData) { cardData.ttsDuration = ttsData.duration; if (!cardData.isDurationManual) { cardData.duration = ttsData.duration; } cardData.audioUrl = ttsData.audioUrl; cardData.ttsReady = true; const totalChars = segmentsForTiming.reduce((sum, s) => sum + s.length, 0); let accumulatedTime = 0; cardData.segments = segmentsForTiming.map(segmentText => { const segmentDuration = totalChars > 0 ? (segmentText.length / totalChars) * ttsData.duration : 0; const segmentTiming = { text: segmentText, startTime: accumulatedTime, duration: segmentDuration }; accumulatedTime += segmentDuration; return segmentTiming; }); if(selectedCardId === cardId) { updateCardUI(cardId); updatePreviewDisplay(); } updateTotalDuration(); } }, 800); }
            function bindCardEvents(cardId) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function updateAllSfxSelects() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function updateCardUI(cardId) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function deleteCard(cardId) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function updateCardNumbers() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function updateTotalDuration() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function showLoadingOnCard(cardId, show, message = 'ìŒì„± ìƒì„± ì¤‘...') { /* ì´ì „ê³¼ ë™ì¼ */ }
            function selectCard(cardId, fromPlayback = false) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function applyTransform(el, layout, animationTransform = '') { /* ì´ì „ê³¼ ë™ì¼ */ }
            function updatePreviewDisplay(forPlayback = false) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function updateScriptStyleControls() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function applyScriptStylesToSelectedCard() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function playBGM(bgmData = globalBGM) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function togglePlay() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function startPlayback() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function stopPlayback() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function playCardByIndex(index) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function setupGptsModal() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function setupExportButton() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function setupImagePaste() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function initializeInteract() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function deactivateAllInteractive() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function setupSequenceFeature() { /* ì´ì „ê³¼ ë™ì¼ */ }
            function showSequenceMenu(x, y) { /* ì´ì „ê³¼ ë™ì¼ */ }
            function hideSequenceMenu() { /* ì´ì „ê³¼ ë™ì¼ */ }

            function bindSidebarEventListeners() {
                globalSettingsPanel.addEventListener('input', (e) => {
                    if (e.target.id.startsWith('st-setting-')) {
                        updateProjectSettings();
                    }
                });
                document.getElementById('st-btn-upload-bgm').addEventListener('click', () => bgmFileInput.click());
                document.getElementById('st-btn-header-logo').addEventListener('click', () => document.getElementById('st-header-logo-file').click());
                document.getElementById('st-header-logo-file').addEventListener('change', (e) => { if (e.target.files && e.target.files[0]) { const reader = new FileReader(); reader.onload = (event) => { projectSettings.header.logo.url = event.target.result; updatePreviewDisplay(); }; reader.readAsDataURL(e.target.files[0]); } });
            }

            async function initialize() { 
                try {
                    const response = await fetch('./sfx-list.json');
                    if (!response.ok) throw new Error('Network response was not ok');
                    SFX_LIST = await response.json();
                } catch (e) {
                    console.error("íš¨ê³¼ìŒ ëª©ë¡(sfx-list.json)ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", e);
                    SFX_LIST = [{ name: "íš¨ê³¼ìŒ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨", url: "" }];
                }
                
                renderGlobalControls(); 
                
                addCardBtn.addEventListener('click', () => addScriptCard('')); 
                newProjectBtn.addEventListener('click', () => { if(confirm('ì •ë§ë¡œ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ì‘ì—… ë‚´ìš©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')) { location.reload(); } }); 
                playAllBtn.addEventListener('click', togglePlay); 
                
                bindSidebarEventListeners();
                
                setupGptsModal(); 
                setupExportButton(); 
                setupImagePaste(); 
                setupSequenceFeature();
                
                sfxFileInput.addEventListener('change', (e) => { if (!e.target.files || e.target.files.length === 0) return; const file = e.target.files[0]; const url = URL.createObjectURL(file); const newSfx = { name: file.name, url }; if (!SFX_LIST.find(item => item.url === url)) { SFX_LIST.push(newSfx); } const cardToUpdate = scriptCards.find(c => c.id === sfxUploadTargetCardId); if (cardToUpdate) { cardToUpdate.sfxUrl = url; } recentlyUsedSfx = [newSfx, ...recentlyUsedSfx.filter(item => item.url !== url)].slice(0, 5); updateAllSfxSelects(); const cardEl = document.querySelector(`.st-card[data-id="${sfxUploadTargetCardId}"]`); if(cardEl) { cardEl.querySelector('.st-sfx-select').value = url; } });
                bgmFileInput.addEventListener('change', (e) => { if (!e.target.files || e.target.files.length === 0) return; const file = e.target.files[0]; const url = URL.createObjectURL(file); let uploadOption = document.getElementById('st-setting-global-bgm').querySelector('option[value="uploaded-bgm"]'); if (!uploadOption) { uploadOption = document.createElement('option'); uploadOption.value = 'uploaded-bgm'; document.getElementById('st-setting-global-bgm').add(uploadOption, 1); } uploadOption.textContent = `(ì—…ë¡œë“œ) ${file.name}`; uploadOption.dataset.url = url; document.getElementById('st-setting-global-bgm').value = 'uploaded-bgm'; openBgmEditor(url, { onConfirm: ({ startTime, endTime }) => { globalBGM = { ...globalBGM, url, startTime, endTime }; if (isPlaying) playBGM(); }, onCancel: () => { document.getElementById('st-setting-global-bgm').value = globalBGM.url || ''; } }); });
                
                new Sortable(cardContainer, { animation: 150, handle: '.st-card-drag-handle', onEnd: function(evt) { const { oldIndex, newIndex } = evt; const [movedItem] = scriptCards.splice(oldIndex, 1); scriptCards.splice(newIndex, 0, movedItem); updateCardNumbers(); } }); 
                initializeInteract(); 
                
                addScriptCard('');
                updatePreviewDisplay();
            }
            initialize();
        });
    </script>
</body>
</html>
