<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SunsakTool (ÏàúÏÇ≠Ìà¥)</title>
    <!-- ÌôîÎ©¥ Ï∫°Ï≤òÎ•º ÏúÑÌïú ÎùºÏù¥Î∏åÎü¨Î¶¨ Ï∂îÍ∞Ä -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=IBM+Plex+Sans+KR:wght@400;700&family=Gowun+Dodum&family=Gowun+Batang&family=Nanum+Myeongjo:wght@400;700;800&family=Do+Hyeon&family=Black+Han+Sans&family=Gaegu:wght@400;700&family=Hi+Melody&family=Noto+Serif+KR:wght@400;700&family=Dokdo&display=swap');
        @font-face { font-family: 'Pretendard'; src: url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff'); font-weight: 400; }
        @font-face { font-family: 'Spoqa Han Sans Neo'; src: url('https://cdn.jsdelivr.net/gh/spoqa/spoqa-han-sans@latest/Subset/SpoqaHanSansNeo/SpoqaHanSansNeo-Regular.woff2') format('woff2'); font-weight: 400; }
        @font-face { font-family: 'GmarketSans'; src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansBold.woff') format('woff'); }
        :root { --st-accent-color: #e82c43; --st-bg-color: #1e1e1e; --st-panel-color: #2a2a2a; --st-border-color: #383838; --st-text-color: #e0e0e0; --st-subtext-color: #aaa; }* { box-sizing: border-box; }body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--st-bg-color); color: var(--st-text-color); display: flex; height: 100vh; margin: 0; overflow: hidden; -webkit-font-smoothing: antialiased; }.st-panel { height: 100vh; display: flex; flex-direction: column; }.st-sidebar { width: 200px; background-color: var(--st-panel-color); padding: 20px; border-right: 1px solid var(--st-border-color); }.st-main-container { flex-grow: 1; display: flex; flex-direction: column; }.st-top-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background-color: var(--st-panel-color); border-bottom: 1px solid var(--st-border-color); flex-shrink: 0; height: 50px;}.st-logo { font-family: 'GmarketSans', sans-serif; font-weight: bold; }.st-main-content { display: flex; flex-grow: 1; overflow: hidden; }.st-preview-area { flex-basis: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }.st-editor-area { flex-grow: 1; border-left: 1px solid var(--st-border-color); border-right: 1px solid var(--st-border-color); overflow-y: auto; padding: 20px; }.st-settings-area { flex-basis: 280px; overflow-y: auto; padding: 20px; background-color: var(--st-panel-color); }button { background-color: var(--st-accent-color); color: #fff; font-weight: bold; cursor: pointer; border: none; border-radius: 4px; padding: 8px 12px; }.st-preview-panel { width: 100%; max-width: 380px; aspect-ratio: 9 / 16; background-color: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.2); display: flex; flex-direction: column; overflow: hidden; }
        .st-preview-header { font-family: 'GmarketSans', sans-serif; color: white; font-weight: bold; flex-shrink: 0; height: 65px; display: flex; justify-content: center; align-items: center; padding: 0 15px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .st-preview-content { padding: 10px; color: black; flex-grow: 1; display: flex; flex-direction: column; background-color: white; overflow: hidden; }.st-project-info { font-size: 13px; color: #555; margin: 0 0 16px 0; border-bottom: 1px solid #eee; padding-bottom: 16px; }.st-project-info .title { font-size: 22px; color: black; font-weight: bold; margin-bottom: 5px; }.st-script-display { flex-grow: 1; display: flex; flex-direction: column; align-items: center; text-align: center; }#st-preview-text { width: 100%; font-size: 24px; color: #000; white-space: pre-wrap; margin-bottom: 8px; flex-shrink: 0; }#st-preview-image-container { width: 100%; display: flex; justify-content: center; align-items: flex-start; }#st-preview-image { max-width: 100%; max-height: 100%; object-fit: contain; }.st-timeline-controls { width: 100%; max-width: 380px; display: flex; align-items: center; gap: 10px; margin-top: 15px;}.st-play-all-btn { background: none; font-size: 24px; padding: 0;}#st-timeline-slider { flex-grow: 1; }.st-editor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }.st-editor-header h3 { margin: 0; }.st-editor-header .button-group { display: flex; gap: 8px; }.st-card { background-color: var(--st-panel-color); border: 2px solid transparent; padding: 15px; margin-top: 15px; border-radius: 4px; cursor: pointer; position: relative; }.st-card.active { border-color: var(--st-accent-color); }.st-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .st-card-drag-handle { cursor: grab; }
        .st-card-drag-handle:active { cursor: grabbing; }
        .st-card-number { font-weight: bold; font-size: 18px; }textarea { width:100%; min-height:60px; background-color: #333; border: 1px solid var(--st-border-color); color: var(--st-text-color); border-radius: 4px; padding: 8px; }.st-card-footer { margin-top: 10px; display: flex; align-items: center; gap: 10px; font-size: 13px; flex-wrap: wrap; }input[type="file"] { display: none; }.st-action-btn { background: none; border:none; color: var(--st-subtext-color); text-decoration: underline; cursor: pointer; padding: 0; font-size: 13px; }.st-play-clip-btn { font-size: 18px; background: none; padding: 0 5px; cursor: pointer; border: none; color: var(--st-text-color); }.st-play-clip-btn:disabled { color: #555; cursor: not-allowed; }.st-card-loading { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); color: white; display: flex; justify-content: center; align-items: center; z-index: 10; border-radius: 4px; font-weight: bold; }.st-accordion-header { padding: 12px 0; cursor: pointer; border-bottom: 1px solid var(--st-border-color); font-weight: bold; }.st-accordion-content { padding: 15px 0; display: none; }.st-accordion-item.active .st-accordion-content { display: block; }.st-control-group { margin-bottom: 15px; }input, select { width: 100%; padding: 8px; background-color: #1e1e1e; border: 1px solid var(--st-border-color); color: var(--st-text-color); }.st-flex-group { display: flex; gap: 10px; }
        .st-modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .st-modal-overlay.visible { display: flex; }
        .st-modal-dialog { background-color: var(--st-panel-color); padding: 24px; border-radius: 8px; width: 90%; max-width: 600px; border: 1px solid var(--st-border-color); }
        .st-modal-dialog h2 { margin-top: 0; font-size: 18px; }
        .st-modal-dialog p { color: var(--st-subtext-color); font-size: 14px; margin-bottom: 16px; }
        .st-modal-dialog textarea { height: 250px; font-size: 14px; margin-bottom: 16px; }
        .st-modal-dialog .st-modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;}
        .st-modal-dialog .st-modal-actions button.cancel { background-color: #555; }
        #st-waveform-container { width: 100%; height: 128px; background-color: #1e1e1e; }
        #st-waveform-loading { text-align: center; padding: 40px; color: var(--st-subtext-color); }
        .st-waveform-controls { margin-top: 15px; display: flex; gap: 10px; align-items: center;}
    </style>
</head>
<body>
    <div class="st-panel st-sidebar"> <button id="st-btn-add-project">+ ÏÉà ÌîÑÎ°úÏ†ùÌä∏</button> </div>
    <div class="st-main-container">
        <div class="st-top-header">
            <div class="st-logo">SunsakTool</div>
            <button id="st-btn-export-image" style="background-color: #007bff;">üñºÔ∏è ÎØ∏Î¶¨Î≥¥Í∏∞ Îã§Ïö¥Î°úÎìú</button>
        </div>
        <div class="st-main-content">
            <div class="st-panel st-preview-area">
                <div class="st-preview-panel" id="st-preview-panel"></div>
                <div class="st-timeline-controls"> <button class="st-play-all-btn" id="st-btn-play-all">‚ñ∂</button> <input type="range" id="st-timeline-slider" value="0" step="0.1"> </div>
            </div>
            <div class="st-panel st-editor-area">
                <div class="st-editor-header">
                    <h3>Ïä§ÌÅ¨Î¶ΩÌä∏ & ÌÉÄÏûÑÎùºÏù∏</h3>
                    <div class="button-group">
                        <button id="st-btn-add-gpts" style="background-color: #3e3e3e;">+ GPTS Ïä§ÌÅ¨Î¶ΩÌä∏ Ï∂îÍ∞Ä</button>
                        <button id="st-btn-add-card">+ Ïä§ÌÅ¨Î¶ΩÌä∏ Ï∂îÍ∞Ä</button>
                    </div>
                </div>
                <div id="st-card-container"></div>
            </div>
            <div class="st-panel st-settings-area" id="st-settings-panel"></div>
        </div>
    </div>
    <div id="st-modal-gpts" class="st-modal-overlay">
        <!-- ... gpts Î™®Îã¨ÏùÄ Ïù¥Ï†ÑÍ≥º ÎèôÏùºÌïòÍ≤å Ïú†ÏßÄ ... -->
    </div>
    <div id="st-modal-bgm" class="st-modal-overlay">
        <!-- ... bgm Î™®Îã¨ÏùÄ Ïù¥Ï†ÑÍ≥º ÎèôÏùºÌïòÍ≤å Ïú†ÏßÄ ... -->
    </div>
    <audio id="st-tts-player" style="display:none;"></audio>
    <audio id="st-bgm-player" style="display:none;" loop></audio>
    <audio id="st-sfx-player" style="display:none;"></audio>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/6.4.0/wavesurfer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/6.4.0/plugin/wavesurfer.regions.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const FONT_LIST = [ { name: 'ÌîÑÎ¶¨ÌÖêÎã§Îìú (Î≥∏Î¨∏Ïö© Ï∂îÏ≤ú)', value: 'Pretendard' }, { name: 'Noto Sans KR (Í∏∞Î≥∏ Í≥†Îîï)', value: "'Noto Sans KR', sans-serif" }, { name: 'GÎßàÏºì ÏÇ∞Ïä§ (Í∞úÏÑ±ÏûàÎäî Ï†úÎ™©)', value: 'GmarketSans' }, { name: 'IBM Plex Sans KR (Î™®ÎçòÌïú Í≥†Îîï)', value: "'IBM Plex Sans KR', sans-serif" }, { name: 'Do Hyeon (Î†àÌä∏Î°ú Ï†úÎ™©)', value: "'Do Hyeon', sans-serif" }, { name: 'ÎÇòÎàîÎ™ÖÏ°∞ (Í∞êÏÑ±Ï†ÅÏù∏ Î≥∏Î¨∏)', value: "'Nanum Myeongjo', serif" }, { name: 'Í≥†Ïö¥ Î∞îÌÉï (Î∂ÄÎìúÎü¨Ïö¥ Î™ÖÏ°∞)', value: "'Gowun Batang', serif" }, { name: 'Black Han Sans (Í∞ïÎ†•Ìïú Ï†úÎ™©)', value: "'Black Han Sans', sans-serif" }, { name: 'Í∞úÍµ¨ (Í∑ÄÏó¨Ïö¥ ÏÜêÍ∏ÄÏî®)', value: "'Gaegu', cursive" }, { name: 'Hi Melody (ÏïÑÍ∏∞ÏûêÍ∏∞ ÏÜêÍ∏ÄÏî®)', value: "'Hi Melody', cursive" }, { name: 'Noto Serif KR (Ï†ïÍ∞àÌïú Î™ÖÏ°∞)', value: "'Noto Serif KR', serif" }, { name: 'Ïä§Ìè¨Ïπ¥ Ìïú ÏÇ∞Ïä§ ÎÑ§Ïò§ (ÍπîÎÅîÌïú Î≥∏Î¨∏)', value: "'Spoqa Han Sans Neo', sans-serif" }, { name: 'ÎèÖÎèÑ (Í±∞Ïπú Î∂ìÍ∏ÄÏî®)', value: "'Dokdo', cursive" }, ];
        const BGM_LIST = [ { name: 'ÏÑ†ÌÉù ÏïàÌï®', url: '' }, { name: 'big-cafe', url: 'https://sunsaktool-final.netlify.app/big-cafe.mp3' }, { name: 'blue-jacket', url: 'https://sunsaktool-final.netlify.app/blue-jacket.mp3' }, { name: 'cute-puppy', url: 'https://sunsaktool-final.netlify.app/cute-puppy.mp3' }, { name: 'laughter-in-the-breeze', url: 'https://sunsaktool-final.netlify.app/laughter-in-the-breeze-_happy_.mp3' }, { name: 'murder-in-my-mind', url: 'https://sunsaktool-final.netlify.app/murder-in-my-mind.mp3' }, { name: 'smiley-composure', url: 'https://sunsaktool-final.netlify.app/smiley-composure.mp3' }, { name: 'spider', url: 'https://sunsaktool-final.netlify.app/spider.mp3' }, { name: 'white-color', url: 'https://sunsaktool-final.netlify.app/white-color.mp3' } ];
        const SFX_LIST = [ { name: 'Ìö®Í≥ºÏùå ÏóÜÏùå', url: '' }, { name: 'Îæ± (Î¨ºÎ∞©Ïö∏)', url: `https://sunsaktool-final.netlify.app/sfx/062_${encodeURIComponent('Îæ± (Î¨ºÎ∞©Ïö∏)')}.mp3` }, { name: 'Ï∞∞Ïπµ (Ïπ¥Î©îÎùº)', url: `https://sunsaktool-final.netlify.app/sfx/078_${encodeURIComponent('Ï∞∞Ïπµ (Ïπ¥Î©îÎùº)')}.mp3` }, { name: 'Í∏∞Ïñ¥ 1', url: 'https://sunsaktool-final.netlify.app/sfx/gears 1.wav' }, { name: 'Í≤åÏûÑÌÅ¥Î¶¨Ïñ¥ (Í≥†Ïùå)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Í≤åÏûÑÌÅ¥Î¶¨Ïñ¥ (Í≥†Ïùå)')}.mp3` }, { name: 'Í∏çÏ†ïÏ†Å ÎßàÎ≤ï ÏÇ¨Ïö©', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Í∏çÏ†ïÏ†Å ÎßàÎ≤ï ÏÇ¨Ïö©')}.mp3` }, { name: 'Íπ®Îã¨Ïùå(Îæ∞Î¥â)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Íπ®Îã¨ÏùåÏùÑ ÏñªÏóàÏùÑ Îïå(Îæ∞Î¥â)')}.mp3` }, { name: 'ÎÜÄÎûå Î∞òÏ†Ñ', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÎÜÄÎûå Î∞òÏ†Ñ')}.mp3` }, { name: 'Îã§Ïùå Ïû•Î©¥Ï†ÑÌôò(Îæ∞Î°úÎ°±)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Îã§Ïùå Ïû•Î©¥Ï†ÑÌôò(Îæ∞Î°úÎ°±)')}.mp3` }, { name: 'ÎÑòÏñ¥Í∞ÄÎäî ÎßëÏùÄ ÏÜåÎ¶¨(Îù†ÎßÅ~)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Îã§ÏùåÏúºÎ°ú ÎÑòÏñ¥Í∞ÄÎäî ÎßëÏùÄ ÏÜåÎ¶¨(Îù†ÎßÅ~)')}.mp3` }, { name: 'ÎèôÏ†ÑÎ®πÎäîÏÜåÎ¶¨ 2Ïó∞ÏÜç(Ï§ëÏùå)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÎèôÏ†ÑÎ®πÎäîÏÜåÎ¶¨ 2Ïó∞ÏÜç(Ï§ëÏùå)')}.mp3` }, { name: 'Îî©ÎèôÎåïÎèô (Ï†ÑÏûêÏùå)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Îî©ÎèôÎåïÎèô (Ï†ÑÏûêÏùå)')}.mp3` }, { name: 'Î¨∏Ïûê Ï†ÑÏÜ°Ïùå(ÎòêÎ°úÎ°±)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Î¨∏Ïûê Ï†ÑÏÜ°Ïùå(ÎòêÎ°úÎ°±)')}.mp3` }, { name: 'Î≥µÏã± ÌÉÄÏù¥Î®∏(Îï°Îï°Îï°)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Î≥µÏã± ÌõàÎ†® ÌÉÄÏù¥Î®∏Í∞Ä Ïö∏Î¶¨Îäî ÏÜåÎ¶¨ (Îï°Îï°Îï°)')}.mp3` }, { name: 'ÎπÑÎîîÏò§ Îπ®Î¶¨Í∞êÍ∏∞ ÏòàÎä•Ïùå', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÎπÑÎîîÏò§ ÌÖåÏù¥ÌîÑ Îπ®Î¶¨Í∞êÍ∏∞ ÏòàÎä•Ïùå')}.mp3` }, { name: 'Îæ∞Î°úÎ°±', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Îæ∞Î°úÎ°±')}.mp3` }, { name: 'Ìúô ÎÇ†Ïπ¥Î°≠Í≤å ÏßÄÎÇòÍ∞ÄÎäî', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ìúô ÎÇ†Ïπ¥Î°≠Í≤å ÏßÄÎÇòÍ∞ÄÎäî')}.mp3` }, { name: 'ÏãúÌïúÌè≠ÌÉÑ Ï¥àÏãúÍ≥Ñ (timer)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÏãúÌïúÌè≠ÌÉÑ Ï¥àÏãúÍ≥Ñ (timer)')}.mp3` }, { name: 'ÏïåÎûå ÏãúÍ∞Ñ Ï¢ÖÎ£å -2 (Ï∞®Î∂Ñ_ beep)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÏïåÎûå ÏãúÍ∞Ñ Ï¢ÖÎ£å -2 (Ï∞®Î∂Ñ_ beep)')}.mp3` }, { name: 'ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ ÎèÑÏ∞©Ïùå2 (ÎùµÎèô)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ ÎèÑÏ∞©Ïùå2 (ÎùµÎèô)')}.mp3` }, { name: 'Ïöï Í∞ÄÎ¶¨Îäî ÏÇêÏ≤òÎ¶¨', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ïöï Í∞ÄÎ¶¨Îäî ÏÇêÏ≤òÎ¶¨')}.mp3` }, { name: 'ÏûëÏùÄ Ïπ¥Î©îÎùº Ï∞∞Ïπµ ÏÜåÎ¶¨', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÏûëÏùÄ Ïπ¥Î©îÎùº Ï∞∞Ïπµ ÏÜåÎ¶¨')}.mp3` }, { name: 'Ï†ÄÎÖÅÏà≤ (Í∞úÍµ¨Î¶¨, Í≥§Ï∂©)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ï†ÄÎÖÅÏà≤ (Í∞úÍµ¨Î¶¨ÏôÄ Í≥§Ï∂©Ïö∏ÏùåÏÜåÎ¶¨)')}.mp3` }, { name: 'ÌîåÎûòÎûò Í±∏Ïñ¥Í∞ÄÎäî ÏÜåÎ¶¨(ÎΩÄÎ≥µ)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÌîåÎûòÎûò Í±∏Ïñ¥Í∞ÄÎäî ÏÜåÎ¶¨(ÎΩÄÎ≥µ)')}.mp3` }, { name: 'Ï≤úÏÇ¨Ïùò Í∞ïÎ¶º', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ï≤úÏÇ¨Ïùò Í∞ïÎ¶º')}.mp3` }, { name: 'Í∞úÏÑú (Ï≤†Ïª•Ïøµ)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Í∞úÏÑú (Ï≤†Ïª•Ïøµ)')}.mp3` }, { name: 'Ïª¥Ìì®ÌÑ∞ ÌÇ§Î≥¥Îìú ÌÉÄÏûê', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ïª¥Ìì®ÌÑ∞ ÌÇ§Î≥¥Îìú ÌÉÄÏûê')}.mp3` }, { name: 'ÌÉÄÏù¥Î®∏ (Ïß∏ÍπçÏß∏Íπç)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('ÌÉÄÏù¥Î®∏ Ïû¨Îäî ÏãúÍ≥ÑÏùå(Ïß∏ÍπçÏß∏Íπç)')}.mp3` }, { name: 'Ìô©ÎãπÌï† Îïå (Îù†ÏöîÏòπ)', url: `https://sunsaktool-final.netlify.app/sfx/mp_${encodeURIComponent('Ìô©ÎãπÌï† Îïå Ìö®Í≥ºÏùå (Îù†ÏöîÏòπ)')}.mp3` }, { name: 'Riser 1', url: 'https://sunsaktool-final.netlify.app/sfx/riser 1.wav' }, { name: 'Whoosh 1', url: 'https://sunsaktool-final.netlify.app/sfx/whoosh1.mp3' }, { name: 'Whoosh 2', url: 'https://sunsaktool-final.netlify.app/sfx/whoosh2.mp3' }, { name: 'Whoosh 3', url: 'https://sunsaktool-final.netlify.app/sfx/whoosh3.wav' }, { name: 'Whoosh 4', url: 'https://sunsaktool-final.netlify.app/sfx/whoosh4.mp3' }, { name: 'ÎòêÎ°úÎ°±', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÎòêÎ°úÎ°±')}.wav` }, { name: 'ÎòêÏïÑÏïô', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÎòêÏïÑÏïô')}.wav` }, { name: 'Îù†Î°úÎ°ù', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Îù†Î°úÎ°ù')}.mp3` }, { name: 'Îù†Î°±(ÏäàÌçºÎßàÎ¶¨Ïò§)', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Îù†Î°±_ÏäàÌçºÎßàÎ¶¨Ïò§')}.mp3` }, { name: 'Îù†Î¶¨ÎßÅ', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Îù†Î¶¨ÎßÅ')}.wav` }, { name: 'Îù†ÎßÅ 1', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ1.wav' }, { name: 'Îù†ÎßÅ 1Ï¥à', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ1Ï¥à.mp3' }, { name: 'Îù†ÎßÅ 2', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ2.mp3' }, { name: 'Îù†ÎßÅ 2Ï¥à', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ2Ï¥à.mp3' }, { name: 'Îù†ÎßÅ 3', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ3.mp3' }, { name: 'Îù†ÎßÅ 4', url: 'https://sunsaktool-final.netlify.app/sfx/Îù†ÎßÅ4.wav' }, { name: 'Îùµ', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Îùµ')}.mp3` }, { name: 'ÎßàÏö∞Ïä§ÌÅ¥Î¶≠(Îî∏Íπç)', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÎßàÏö∞Ïä§ÌÅ¥Î¶≠_Îî∏Íπç')}.mp3` }, { name: 'Îæ∞Ïò• 1', url: 'https://sunsaktool-final.netlify.app/sfx/Îæ∞Ïò•1.wav' }, { name: 'Îæ∞Ïò• 2', url: 'https://sunsaktool-final.netlify.app/sfx/Îæ∞Ïò•2.mp3' }, { name: 'Îæ∞Ïò• 3', url: 'https://sunsaktool-final.netlify.app/sfx/Îæ∞Ïò•3.wav' }, { name: 'ÎΩÅ 1Ï¥à', url: 'https://sunsaktool-final.netlify.app/sfx/ÎΩÅ1Ï¥à.mp3' }, { name: 'ÏÇêÎ¶¨ÏÇêÎπÖ', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÏÇêÎ¶¨ÏÇêÎπÖ')}.mp3` }, { name: 'ÏÇë', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÏÇë')}.mp3` }, { name: 'ÏÖîÌÑ∞', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÏÖîÌÑ∞')}.wav` }, { name: 'Ïäâ 1Ï¥à', url: 'https://sunsaktool-final.netlify.app/sfx/Ïäâ1Ï¥à.mp3' }, { name: 'Ïä§ÏúΩ', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Ïä§ÏúΩ')}.mp3` }, { name: 'Ïòà!', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Ïòà!')}.mp3` }, { name: 'ÏôÄÏö∞', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÏôÄÏö∞')}.wav` }, { name: 'Ï∞∞Ïπµ(ÏÜåÎ¶¨)', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Ï∞∞Ïπµ')}.wav` }, { name: 'Ï∫êÏÑú', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Ï∫êÏÑú')}.mp3` }, { name: 'ÌÇ§Î≥¥ÎìúÌÉÄÏù¥Ìïë', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÌÇ§Î≥¥ÎìúÌÉÄÏù¥Ìïë')}.mp3` }, { name: 'ÌàΩ', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÌàΩ')}.mp3` }, { name: 'Ìè≠Î∞ú 1', url: 'https://sunsaktool-final.netlify.app/sfx/Ìè≠Î∞ú1.mp3' }, { name: 'Ìè≠Î∞ú 2', url: 'https://sunsaktool-final.netlify.app/sfx/Ìè≠Î∞ú2.mp3' }, { name: 'Ìè≠Î∞ú(ÌÅ∞)', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('Ìè≠Î∞ú_ÌÅ∞')}.mp3` }, { name: 'ÌõÑÏö±', url: `https://sunsaktool-final.netlify.app/sfx/${encodeURIComponent('ÌõÑÏö±')}.mp3` } ];
    
        let globalBGM = { url: null, volume: 0.3, startTime: 0, endTime: null };
        let scriptCards = [];
        let isPlaying = false;
        let ttsCache = new Map();
        let playbackCurrentIndex = 0;
        let selectedCardId = null;

        const cardContainer = document.getElementById('st-card-container');
        const playAllBtn = document.getElementById('st-btn-play-all');
        const timelineSlider = document.getElementById('st-timeline-slider');
        const ttsPlayer = document.getElementById('st-tts-player');
        const bgmPlayer = document.getElementById('st-bgm-player');
        const sfxPlayer = document.getElementById('st-sfx-player'); 
        const settingsPanel = document.getElementById('st-settings-panel');
        const addCardBtn = document.getElementById('st-btn-add-card');
        
        const addGptsBtn = document.getElementById('st-btn-add-gpts');
        const gptsModal = document.getElementById('st-modal-gpts');
        const gptsCancelBtn = document.getElementById('st-btn-gpts-cancel');
        const gptsConfirmBtn = document.getElementById('st-btn-gpts-confirm');
        const gptsTextarea = document.getElementById('st-gpts-textarea');

        let wavesurfer = null;
        let activeRegion = null;
        let bgmEditorContext = { callback: null, currentBgm: null };
        
        // ‚ú® BGM ÎØ∏Î¶¨Î≥¥Í∏∞ Í∏∞Îä•Ïù¥ ÏôÑÎ≤ΩÌûà Î≥µÍµ¨Îêú ÏµúÏ¢Ö Î≤ÑÏ†ÑÏûÖÎãàÎã§.
        function initializeBgmEditor() {
            if (wavesurfer) return;
            if (typeof WaveSurfer === 'undefined') { 
                return alert("BGM Ìé∏ÏßëÍ∏∞ ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎî©Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ÌïòÍ≥† ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ® Ìï¥Ï£ºÏÑ∏Ïöî."); 
            }
            
            wavesurfer = WaveSurfer.create({
                container: '#st-waveform-container', waveColor: '#ddd', progressColor: '#e82c43', cursorColor: '#fff', barWidth: 2, barRadius: 3,
                plugins: [
                    WaveSurfer.regions.create({
                        dragSelection: {
                            slop: 5
                        }
                    })
                ]
            });

            wavesurfer.on('error', (err) => { console.error('WaveSurfer Error:', err); alert('BGM ÌååÏùºÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.'); closeBgmEditor(); });

            wavesurfer.on('ready', () => {
                document.getElementById('st-waveform-loading').style.display = 'none';
                wavesurfer.clearRegions();
                
                const totalDuration = wavesurfer.getDuration();
                const regionDuration = Math.min(60, totalDuration);

                let region = wavesurfer.addRegion({
                    start: 0, end: regionDuration, color: 'rgba(232, 44, 67, 0.3)',
                    drag: true, resize: false,
                });
                
                activeRegion = region;
                document.getElementById('st-bgm-time-display').textContent = `${region.start.toFixed(2)}s - ${region.end.toFixed(2)}s`;
            });

            wavesurfer.on('region-updated', (region) => {
                 activeRegion = region;
                 document.getElementById('st-bgm-time-display').textContent = `${region.start.toFixed(2)}s - ${region.end.toFixed(2)}s`;
            });

            wavesurfer.on('region-clicked', (region, e) => {
                e.stopPropagation();
                activeRegion = region;
                region.play();
            });

            document.getElementById('st-btn-bgm-play-pause').addEventListener('click', () => wavesurfer.playPause());
            document.getElementById('st-btn-bgm-play-region').addEventListener('click', () => { if (activeRegion) activeRegion.play(); });
            document.getElementById('st-btn-bgm-confirm').addEventListener('click', () => {
                if (bgmEditorContext.callback && activeRegion) { bgmEditorContext.callback({ startTime: activeRegion.start, endTime: activeRegion.end }); }
                closeBgmEditor();
            });
            document.getElementById('st-btn-bgm-cancel').addEventListener('click', closeBgmEditor);
        }

        function openBgmEditor(url, currentBgm, callback) {
            bgmEditorContext = { callback, currentBgm };
            document.getElementById('st-modal-bgm').classList.add('visible');
            document.getElementById('st-waveform-loading').style.display = 'block';
            if (!wavesurfer) initializeBgmEditor();
            if (wavesurfer) {
                if(wavesurfer.isReady) {
                    wavesurfer.destroy();
                    initializeBgmEditor();
                }
                wavesurfer.load(url);
            }
        }
        function closeBgmEditor() {
            document.getElementById('st-modal-bgm').classList.remove('visible');
            if (wavesurfer) {
                wavesurfer.stop();
            }
        }
        const debounce = (callback, delay) => { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => callback(...args), delay); }; };
        const getAudioDuration = (url) => new Promise(resolve => { const audio = new Audio(); audio.onloadedmetadata = () => resolve(audio.duration); audio.src = url; });

        // ‚ú® TTS Í∏∞Îä•Ïù¥ ÏÑúÎ≤ÑÎ•º Ìò∏Ï∂úÌïòÎèÑÎ°ù Î≥µÍµ¨ÎêòÏóàÏäµÎãàÎã§.
        async function fetchTTS(text, cardId) {
            text = text.trim();
            if (!text) return null;
            const cacheKey = text; 
            if (ttsCache.has(cacheKey)) return ttsCache.get(cacheKey);
            showLoadingOnCard(cardId, true, 'ÏÑúÎ≤ÑÏóê ÏöîÏ≤≠ Ï§ë...');
            try {
                const response = await fetch('/.netlify/functions/create-tts', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ text: text }) });
                if (!response.ok) {
                    const errorResult = await response.json();
                    throw new Error(`[${response.status}] ${errorResult.error || 'ÏÑúÎ≤Ñ ÏöîÏ≤≠ Ïã§Ìå®'}`);
                }
                const result = await response.json();
                const audioUrl = result.audioUrl;
                const duration = await getAudioDuration(audioUrl);
                const ttsData = { audioUrl, duration };
                ttsCache.set(cacheKey, ttsData);
                return ttsData;
            } catch (error) {
                console.error('TTS ÏÉùÏÑ± Ïò§Î•ò:', error);
                alert(`ÏùåÏÑ± ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}`);
                return null;
            } finally {
                showLoadingOnCard(cardId, false);
            }
        }
        
        // ‚ú® Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥Î°úÎìú Í∏∞Îä•Ïù¥ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÇ¨Ïù¥ÎìúÎ°ú Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.
        function setupExportButton() {
            const exportBtn = document.getElementById('st-btn-export-image');
            if (!exportBtn) return;

            exportBtn.addEventListener('click', () => {
                const previewPanel = document.getElementById('st-preview-panel');
                if (!previewPanel) return;

                exportBtn.disabled = true;
                exportBtn.textContent = 'Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ï§ë...';

                html2canvas(previewPanel, {
                    allowTaint: true,
                    useCORS: true,
                    backgroundColor: '#1e1e1e'
                }).then(canvas => {
                    const imageData = canvas.toDataURL('image/jpeg', 0.95);
                    const link = document.createElement('a');
                    link.href = imageData;
                    link.download = 'sunsak-preview.jpg';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }).catch(err => {
                    console.error('Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ïò§Î•ò:', err);
                    alert('ÎØ∏Î¶¨Î≥¥Í∏∞ Ïù¥ÎØ∏ÏßÄÎ•º ÏÉùÏÑ±ÌïòÎäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }).finally(() => {
                    exportBtn.disabled = false;
                    exportBtn.textContent = 'üñºÔ∏è ÎØ∏Î¶¨Î≥¥Í∏∞ Îã§Ïö¥Î°úÎìú';
                });
            });
        }
        
        function initialize() {
            // Ïó¨Í∏∞Ïóê Î™®Îì† ÎÇòÎ®∏ÏßÄ Ìï®ÏàòÎì§Ïù¥ ÏôÄÏïº Ìï©ÎãàÎã§.
            // renderControls, addScriptCard, deleteCard, updateCardNumbers, updateTotalDuration,
            // showLoadingOnCard, selectCard, updatePreviewDisplay, updateScriptStyleControls,
            // applyScriptStylesToSelectedCard, playBGM, togglePlay, startPlayback, stopPlayback,
            // playCardByIndex, setupGptsModal
            // Ïù¥ Î™®Îì† Ìï®ÏàòÎì§ÏùÑ Ïó¨Í∏∞Ïóê Ìè¨Ìï®ÏãúÏºúÏïº ÏôÑÏ†ÑÌïú ÏΩîÎìúÍ∞Ä Îê©ÎãàÎã§.
            // (Ïù¥Ï†Ñ ÎãµÎ≥ÄÏùò ÏôÑÏ†ÑÌïú ÏΩîÎìúÎ•º Ï∞∏Ï°∞ÌïòÏó¨ Ïù¥ Î∂ÄÎ∂ÑÏùÑ Ï±ÑÏõåÏ£ºÏÑ∏Ïöî)
            
            // Ï¥àÍ∏∞Ìôî Ìò∏Ï∂ú
            renderControls();
            updatePreviewDisplay(); 
            addCardBtn.addEventListener('click', () => addScriptCard(''));
            playAllBtn.addEventListener('click', togglePlay);
            
            setupGptsModal();
            setupExportButton();

            document.getElementById('st-setting-global-bgm').addEventListener('change', (e) => {
                const url = e.target.value;
                if (url) {
                    openBgmEditor(url, globalBGM, ({ startTime, endTime }) => {
                        globalBGM = { ...globalBGM, url, startTime, endTime };
                        if (isPlaying) playBGM();
                    });
                } else {
                    globalBGM.url = null;
                    if (isPlaying) bgmPlayer.pause();
                }
            });
            document.getElementById('st-setting-global-bgm-volume').addEventListener('input', (e) => {
                globalBGM.volume = parseFloat(e.target.value);
                bgmPlayer.volume = globalBGM.volume;
            });

            new Sortable(cardContainer, {
                animation: 150,
                handle: '.st-card-drag-handle',
                onEnd: function(evt) {
                    const { oldIndex, newIndex } = evt;
                    const [movedItem] = scriptCards.splice(oldIndex, 1);
                    scriptCards.splice(newIndex, 0, movedItem);
                    updateCardNumbers();
                }
            });

            addScriptCard('SunsakToolÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!');
        }
        
        // Ïó¨Í∏∞ÏÑú Îπ†ÏßÑ Ìï®ÏàòÎì§ÏùÑ Ï±ÑÏõåÏïº Ìï©ÎãàÎã§.
        // renderControls, addScriptCard Îì±Ïùò Ìï®Ïàò Ï†ïÏùòÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.
        
        initialize();
    });
    </script>
</body>
</html>
