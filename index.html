<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SunsakTool - ìˆí¼ ì˜ìƒ ì œì‘ê¸°</title>
    <!-- Google Fonts Link -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&family=Gaegu&family=Gowun+Batang&family=Hi+Melody&family=IBM+Plex+Sans+KR&family=Nanum+Myeongjo&family=Noto+Sans+KR:wght@400;700&family=Noto+Serif+KR&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/pretendard/dist/web/static/pretendard.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gmarket-sans-font@1.0.0/css/gmarket-sans.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />

    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼, ë ˆì´ì•„ì›ƒ ë“± */
        :root { --st-primary-color: #e82c43; --st-bg-color: #f8f9fa; --st-panel-bg: #fff; --st-border-color: #dee2e6; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--st-bg-color); color: #333; display: flex; height: 100vh; overflow: hidden; }
        .st-main-container { display: flex; width: 100%; height: 100%; }
        .st-script-panel, .st-preview-wrapper, .st-settings-panel-wrapper { padding: 15px; background-color: var(--st-panel-bg); display: flex; flex-direction: column; }
        .st-script-panel { width: 30%; border-right: 1px solid var(--st-border-color); }
        .st-preview-wrapper { flex-grow: 1; align-items: center; justify-content: flex-start; background: #f0f0f0; position: relative; } /* ê°€ì´ë“œë¼ì¸ ê¸°ì¤€ì  */
        .st-settings-panel-wrapper { width: 280px; border-left: 1px solid var(--st-border-color); overflow-y: auto; }
        
        /* ê³µí†µ ë²„íŠ¼ ë° ì»¨íŠ¸ë¡¤ */
        button, .st-action-btn { cursor: pointer; border: 1px solid var(--st-border-color); background: #fff; padding: 8px 12px; border-radius: 4px; transition: background-color 0.2s; }
        button:hover, .st-action-btn:hover { background-color: #f1f3f5; }
        button:disabled { cursor: not-allowed; opacity: 0.5; }
        input[type="text"], input[type="number"], select, textarea { width: 100%; padding: 8px; border: 1px solid var(--st-border-color); border-radius: 4px; }
        
        /* ìŠ¤í¬ë¦½íŠ¸ ì¹´ë“œ ë¶€ë¶„ */
        .st-panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        #st-card-container { flex-grow: 1; overflow-y: auto; padding-right: 5px; }
        .st-card { border: 1px solid var(--st-border-color); border-radius: 6px; margin-bottom: 10px; background-color: #fff; position: relative; }
        .st-card.active { border-color: var(--st-primary-color); box-shadow: 0 0 5px rgba(232, 44, 67, 0.5); }
        .st-card-header { display: flex; justify-content: space-between; align-items: center; background-color: #f8f9fa; padding: 5px 10px; border-bottom: 1px solid var(--st-border-color); }
        .st-card-drag-handle { cursor: move; }
        .st-card textarea { width: 100%; height: 80px; border: none; padding: 10px; resize: vertical; }
        .st-card-footer { display: flex; align-items: center; padding: 5px 10px; gap: 10px; font-size: 12px; color: #868e96; }
        input[type="file"] { display: none; }
        .st-card-loading { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); display: flex; align-items: center; justify-content: center; z-index: 10; }

        /* ë¯¸ë¦¬ë³´ê¸° íŒ¨ë„ (ê¸°ì¡´ ë ˆì´ì•„ì›ƒ ìœ ì§€) */
        #st-preview-panel {
            width: 360px;
            height: 640px;
            background-color: #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin-top: 20px;
            position: relative; /* ìŠ¤ë§ˆíŠ¸ ê°€ì´ë“œ ê¸°ì¤€ì  */
        }
        .st-preview-header {
            padding: 12px;
            text-align: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0; /* âœ¨ í—¤ë” í¬ê¸° ê³ ì • âœ¨ */
        }
        .st-preview-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 15px;
        }
        .st-project-info {
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            margin-bottom: 10px;
            flex-shrink: 0; /* í¬ê¸° ê³ ì • */
        }
        .st-project-info .title {
            font-size: 20px;
            font-weight: bold;
        }
        /* âœ¨ ì›ë³¸ ì½”ë“œë¥¼ ë³µì›í•©ë‹ˆë‹¤. âœ¨ */
        .st-script-display {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            /* justify-content ì œê±°. ì›ë˜ ë ˆì´ì•„ì›ƒìœ¼ë¡œ */
        }
        #st-preview-text-container, #st-preview-image-container {
            border: 2px solid transparent;
            cursor: move;
            transition: border-color 0.2s;
            touch-action: none;
        }
        #st-preview-text-container.interactive-active, #st-preview-image-container.interactive-active {
            border-color: var(--st-primary-color);
            z-index: 100;
        }
        #st-preview-text {
            /* âœ¨ ì›ë³¸ ë ˆì´ì•„ì›ƒ ë³µì› âœ¨ */
            transform-origin: center;
        }
        #st-preview-image-container {
            margin-top: 16px; /* âœ¨ ì‚¬ìš©ìë‹˜ì´ ë§ì¶˜ 16px ê°„ê²©! âœ¨ */
            transform-origin: center;
        }
        #st-preview-image {
            width: 100%;
            height: auto;
            object-fit: contain;
            display: block;
        }
        
        /* ìŠ¤ë§ˆíŠ¸ ê°€ì´ë“œ ë¼ì¸ */
        .snap-guide-v {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background-color: var(--st-primary-color);
            display: none;
            z-index: 999;
        }

        /* ì„¤ì • íŒ¨ë„ (Accordion) */
        /* ... (ì´í•˜ ë™ì¼) ... */
    </style>
</head>
<body>
    <!-- HTML êµ¬ì¡°ëŠ” ì´ì „ê³¼ ë™ì¼ -->
    <audio id="st-tts-player"></audio>
    <audio id="st-bgm-player" loop></audio>
    <audio id="st-sfx-player"></audio>
    
    <div class="st-main-container">
        <!-- ìŠ¤í¬ë¦½íŠ¸ íŒ¨ë„ -->
        <div class="st-script-panel">
            <div class="st-panel-header">
                <h2>ìŠ¤í¬ë¦½íŠ¸ ëª©ë¡</h2>
                <div>
                    <button id="st-btn-add-gpts">GPTs</button>
                    <button id="st-btn-add-card">ì¶”ê°€ +</button>
                </div>
            </div>
            <div id="st-card-container"></div>
        </div>

        <!-- ë¯¸ë¦¬ë³´ê¸° íŒ¨ë„ -->
        <div class="st-preview-wrapper">
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <button id="st-btn-play-all">â–¶ ì „ì²´ ì¬ìƒ</button>
                <button id="st-btn-export-video">ğŸ¬ ì˜ìƒ ì¶œë ¥ (1080p)</button>
            </div>
            <div class="snap-guide-v"></div>
            <div id="st-preview-panel">
                 <div class="st-preview-header"></div>
                 <div class="st-preview-content">
                     <div class="st-project-info">
                         <div class="title"></div>
                         <span></span>
                     </div>
                     <div class="st-script-display">
                        <div id="st-preview-text-container">
                            <div id="st-preview-text"></div>
                        </div>
                        <div id="st-preview-image-container">
                            <img id="st-preview-image">
                        </div>
                     </div>
                 </div>
            </div>
        </div>
        <!-- ... (ì´í•˜ HTML ë™ì¼) ... -->
    </div>
    
    <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ ìŠ¤í¬ë¦½íŠ¸ -->
    <!-- ... (ì´í•˜ ë™ì¼) ... -->

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- ìƒìˆ˜ ë° ì „ì—­ ë³€ìˆ˜ ---
        // ... (ì´ì „ê³¼ ë™ì¼)
        
        // --- âœ¨ ì¹´ë“œ ì¶”ê°€ í•¨ìˆ˜ (transform ë°ì´í„° êµ¬ì¡° ìœ ì§€) --- âœ¨
        function addScriptCard(text = '') {
            const cardId = `card-${Date.now()}-${Math.floor(Math.random() * 10000)}`;
            const cardData = {
                id: cardId, text, duration: 0.5, imageUrl: null, audioUrl: null, ttsReady: false, sfxUrl: null,
                style: {
                    fontFamily: "'Noto Sans KR', sans-serif",
                    fontSize: '24px',
                    color: '#000000',
                },
                // âœ¨ ìœ„ì¹˜/í¬ê¸° ì¡°ì •ì„ ìœ„í•œ transform ë°ì´í„° (ì´ˆê¸°ê°’ì€ 0, 1ë¡œ ê³ ì •) âœ¨
                transform: {
                    text:  { x: 0, y: 0, scale: 1 },
                    image: { x: 0, y: 0, scale: 1 }
                }
            };
            scriptCards.push(cardData);
            // ì¹´ë“œ HTML ìƒì„± ë° ì´ë²¤íŠ¸ ë°”ì¸ë”© (ì´ì „ê³¼ ë™ì¼)
            // ...
        }
        
        // --- âœ¨ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì™„ì „ ë³µì›) --- âœ¨
        function updatePreviewDisplay() {
            // í—¤ë”, í”„ë¡œì íŠ¸ ì •ë³´ ë“± ê¸°ì¡´ ë¡œì§
            const headerEl = document.querySelector('.st-preview-header'); /* ... */
            
            const card = scriptCards.find(c => c.id === selectedCardId);
            const textContainer = document.getElementById('st-preview-text-container');
            const imageContainer = document.getElementById('st-preview-image-container');
            const textEl = document.getElementById('st-preview-text');
            const imageEl = document.getElementById('st-preview-image');

            if (card) {
                // í…ìŠ¤íŠ¸ì™€ ì´ë¯¸ì§€ ë‚´ìš© ì—…ë°ì´íŠ¸
                textEl.textContent = card.text;
                Object.assign(textEl.style, card.style);

                if (card.imageUrl) {
                    imageEl.src = card.imageUrl;
                    imageContainer.style.display = 'block';
                } else {
                    imageContainer.style.display = 'none';
                    imageEl.src = '';
                }

                // âœ¨ ì €ì¥ëœ transform ê°’ ì ìš© (í•µì‹¬) âœ¨
                const applyTransform = (el, transform) => {
                    el.style.transform = `translate(${transform.x}px, ${transform.y}px) scale(${transform.scale})`;
                };
                applyTransform(textContainer, card.transform.text);
                applyTransform(imageContainer, card.transform.image);
            } else {
                // ì„ íƒëœ ì¹´ë“œê°€ ì—†ì„ ë•Œ ì´ˆê¸°í™” (ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ë³´ì´ë„ë¡)
                textEl.textContent = 'ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”.';
                Object.assign(textEl.style, { fontFamily: 'Noto Sans KR', fontSize: '16px', color: '#555' });
                imageContainer.style.display = 'none';
                
                // transform ì´ˆê¸°í™”
                textContainer.style.transform = 'translate(0px, 0px) scale(1)';
                imageContainer.style.transform = 'translate(0px, 0px) scale(1)';
            }
        }
        
        // --- âœ¨ Interact.js ì´ˆê¸°í™” ë° ë¡œì§ (ê°œì„ ) --- âœ¨
        function initializeInteract() {
            const verticalGuide = document.querySelector('.snap-guide-v');
            const previewPanel = document.getElementById('st-preview-panel');

            // ... (ë‚˜ë¨¸ì§€ ë¡œì§ì€ ì´ì „ê³¼ ë™ì¼í•˜ë¯€ë¡œ ì „ì²´ ì½”ë“œë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”)
        }
        
        // --- ë‚˜ë¨¸ì§€ ìœ í‹¸ë¦¬í‹° ë° ì´ˆê¸°í™” í•¨ìˆ˜ë“¤ ---
        // ... (ìƒëµëœ ëª¨ë“  í•¨ìˆ˜ëŠ” ì´ì „ê³¼ ë™ì¼í•©ë‹ˆë‹¤)

        function initialize() {
            renderControls(); 
            // âœ¨ ì²« í™”ë©´ì´ ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ë³´ì´ë„ë¡ ìˆ˜ì • âœ¨
            // addScriptCardë¥¼ ë°”ë¡œ í˜¸ì¶œí•˜ì§€ ì•Šê³ , ì´ˆê¸° ë·°ë¥¼ ë¨¼ì € ê·¸ë¦¼
            updatePreviewDisplay(); 

            addCardBtn.addEventListener('click', () => {
                if(scriptCards.length === 0) {
                     addScriptCard('SunsakToolì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!');
                } else {
                     addScriptCard('');
                }
            }); 
            // ... (ê¸°íƒ€ ì´ˆê¸°í™” ì½”ë“œ)
            
            initializeInteract();
        }
        
        initialize();
    });
    </script>
</body>
</html>
