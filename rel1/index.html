<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SunsakTool 4.0</title>
    <!-- 폰트 로드 -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=IBM+Plex+Sans+KR:wght@400;700&family=Gowun+Dodum&family=Gowun+Batang&family=Nanum+Myeongjo:wght@400;700;800&family=Do+Hyeon&family=Black+Han+Sans&family=Gaegu:wght@400;700&family=Hi+Melody&family=Noto+Serif+KR:wght@400;700&family=Dokdo&display=swap');
        @font-face { font-family: 'Pretendard'; src: url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff'); font-weight: 400; }
        @font-face { font-family: 'Spoqa Han Sans Neo'; src: url('https://cdn.jsdelivr.net/gh/spoqa/spoqa-han-sans@latest/Subset/SpoqaHanSansNeo/SpoqaHanSansNeo-Regular.woff2') format('woff2'); font-weight: 400; }
        @font-face { font-family: 'GmarketSans'; src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansBold.woff') format('woff'); }
        
        /* CSS 스타일 */
        :root { 
            --st-accent-color: #e82c43; --st-bg-color: #1e1e1e; --st-panel-color: #2a2a2a; 
            --st-border-color: #383838; --st-text-color: #e0e0e0; --st-subtext-color: #aaa;
            --drawer-height: 300px;
        }
        * { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; overflow: hidden; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--st-bg-color); color: var(--st-text-color); -webkit-font-smoothing: antialiased; }

        /* ✨ NEW: 최종 레이아웃 구조 */
        .st-container { display: flex; height: 100vh; }
        .st-sidebar { flex: 0 0 200px; background-color: var(--st-panel-color); display: flex; flex-direction: column; border-right: 1px solid var(--st-border-color); }
        .st-main-content { flex-grow: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        .st-workspace { display: flex; flex-grow: 1; overflow: hidden; }
        .st-header { display: flex; justify-content: space-between; align-items: center; padding: 0 20px; background-color: #1a1a1a; border-bottom: 1px solid var(--st-border-color); flex-shrink: 0; height: 50px; width: 100%; }
        .st-logo { font-family: 'GmarketSans', sans-serif; font-weight: bold; }
        .st-project-title-display { font-size: 16px; font-weight: bold; color: var(--st-accent-color); }

        /* ✨ NEW: 디자인 & 컨트롤 서랍 (Drawer) */
        .st-drawer { position: absolute; bottom: 0; left: 0; right: 0; background-color: var(--st-panel-color); border-top: 1px solid var(--st-border-color); transform: translateY(calc(100% - 40px)); transition: transform 0.3s ease-in-out; }
        .st-drawer.is-open { transform: translateY(0); }
        .st-drawer-handle { height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; user-select: none; }
        .st-drawer-handle:hover { background-color: #333; }
        .st-drawer-content { height: calc(var(--drawer-height) - 40px); overflow-y: auto; }

        /* 패널 공통 스타일 */
        .st-panel { display: flex; flex-direction: column; padding: 20px; }
        .st-panel-header { padding: 0 0 15px 0; font-weight: bold; font-size: 16px; margin: 0; }
        
        .st-preview-area { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #252526; }
        .st-editor-area { flex: 1; display: flex; flex-direction: column; border-left: 1px solid var(--st-border-color); }
        
        /* 사이드바 (프로젝트 목록) */
        .st-project-list { list-style: none; padding: 0; margin: 0; flex-grow: 1; overflow-y: auto; }
        .st-project-list li { padding: 12px 20px; cursor: pointer; border-bottom: 1px solid var(--st-border-color); font-size: 14px; }
        .st-project-list li:hover { background-color: #333; }
        .st-project-list li.active { background-color: var(--st-accent-color); font-weight: bold; }
        
        /* 미리보기 패널 */
        .st-preview-panel { width: 100%; max-width: 360px; aspect-ratio: 9 / 16; background-color: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.2); display: flex; flex-direction: column; overflow: hidden; }
        .st-preview-header { font-family: 'GmarketSans', sans-serif; color: white; font-weight: bold; flex-shrink: 0; height: 65px; display: flex; justify-content: center; align-items: center; padding: 0 15px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .st-preview-content { padding: 10px; color: black; flex-grow: 1; display: flex; flex-direction: column; background-color: white; overflow: hidden; }
        .st-project-info { font-size: 13px; color: #555; margin: 0 0 16px 0; border-bottom: 1px solid #eee; padding-bottom: 16px; }
        .st-project-info .title { font-size: 22px; color: black; font-weight: bold; margin-bottom: 5px; }
        .st-script-display { flex-grow: 1; display: flex; flex-direction: column; align-items: center; text-align: center; }
        #st-preview-text { width: 100%; font-size: 24px; color: #000; white-space: pre-wrap; margin-bottom: 8px; flex-shrink: 0; }
        #st-preview-image-container { width: 100%; display: flex; justify-content: center; align-items: flex-start; }
        #st-preview-image { max-width: 100%; max-height: 100%; object-fit: contain; }
        .st-timeline-controls { width: 100%; max-width: 360px; display: flex; align-items: center; gap: 10px; margin-top: 15px;}
        .st-play-all-btn { background: none; font-size: 24px; padding: 0;}
        #st-timeline-slider { flex-grow: 1; }
        
        /* 스크립트 카드 */
        #st-card-container { flex-grow: 1; overflow-y: auto; padding-right: 10px;}
        .st-card { background-color: var(--st-panel-color); border: 2px solid transparent; padding: 15px; margin-bottom: 15px; border-radius: 4px; cursor: pointer; position: relative; }
        .st-card.active { border-color: var(--st-accent-color); }
        .st-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .st-card-drag-handle { cursor: grab; }
        .st-card-drag-handle:active { cursor: grabbing; }
        .st-card-number { font-weight: bold; font-size: 18px; }
        textarea { width:100%; min-height:60px; background-color: #333; border: 1px solid var(--st-border-color); color: var(--st-text-color); border-radius: 4px; padding: 8px; }
        .st-card-footer { margin-top: 10px; display: flex; align-items: center; gap: 10px; font-size: 13px; flex-wrap: wrap; }
        input[type="file"] { display: none; }
        .st-action-btn { background: none; border:none; color: var(--st-subtext-color); text-decoration: underline; cursor: pointer; padding: 0; font-size: 13px; }
        .st-play-clip-btn { font-size: 18px; background: none; padding: 0 5px; cursor: pointer; border: none; color: var(--st-text-color); }
        .st-play-clip-btn:disabled { color: #555; cursor: not-allowed; }
        .st-card-loading { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); color: white; display: flex; justify-content: center; align-items: center; z-index: 10; border-radius: 4px; font-weight: bold; }

        /* 아코디언 메뉴 스타일 */
        .st-accordion-item { border-bottom: 1px solid var(--st-border-color); }
        .st-accordion-header { padding: 15px 20px; cursor: pointer; font-weight: bold; user-select: none; }
        .st-accordion-header:hover { background-color: #333; }
        .st-accordion-content { padding: 20px; display: none; background-color: #1e1e1e; }
        .st-accordion-item.active .st-accordion-content { display: block; }
        .st-control-group { margin-bottom: 15px; }
        .st-flex-group { display: flex; gap: 10px; }
        
        /* 모달 공통 */
        .st-modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .st-modal-overlay.visible { display: flex; }
        .st-modal-dialog { background-color: var(--st-panel-color); padding: 24px; border-radius: 8px; width: 90%; max-width: 600px; border: 1px solid var(--st-border-color); }
        .st-modal-dialog h2 { margin-top: 0; font-size: 18px; }
        .st-modal-dialog p { color: var(--st-subtext-color); font-size: 14px; margin-bottom: 16px; }
        .st-modal-dialog textarea { height: 250px; font-size: 14px; margin-bottom: 16px; }
        .st-modal-dialog .st-modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;}
        .st-modal-dialog .st-modal-actions button.cancel { background-color: #555; }

        /* BGM 에디터 모달 */
        #st-waveform-container { width: 100%; height: 128px; background-color: #1e1e1e; }
        #st-waveform-loading { text-align: center; padding: 40px; color: var(--st-subtext-color); }
        .st-waveform-controls { margin-top: 15px; display: flex; gap: 10px; align-items: center;}
    </style>
</head>
<body>
    <div class="st-container">
        <aside class="st-sidebar">
            <h2 class="st-panel-header">프로젝트 목록</h2>
            <ul id="st-project-list" class="st-project-list"></ul>
            <button id="st-btn-new-project" style="margin: 20px; flex-shrink: 0;">+ 새 프로젝트</button>
        </aside>

        <div class="st-main-content">
            <header class="st-header">
                <div class="st-logo">SunsakTool 4.0</div>
                <div id="st-project-title-display" class="st-project-title-display"></div>
            </header>
            <main class="st-workspace">
                <div class="st-preview-area">
                    <div class="st-preview-panel" id="st-preview-panel"></div>
                    <div class="st-timeline-controls">
                        <button class="st-play-all-btn" id="st-btn-play-all">▶</button>
                        <input type="range" id="st-timeline-slider" value="0" step="0.1">
                    </div>
                </div>
                <div class="st-editor-area">
                    <div class="st-panel-header st-editor-header">
                        <h3>스크립트</h3>
                        <div class="button-group">
                            <button id="st-btn-add-smart-script" style="background-color: #3e3e3e;">+ 스마트 대본 붙여넣기</button>
                            <button id="st-btn-add-card">+ 빈 카드 추가</button>
                        </div>
                    </div>
                    <div id="st-card-container" class="st-panel-content"></div>
                </div>
            </main>
            <div id="st-drawer" class="st-drawer">
                <div id="st-drawer-handle" class="st-drawer-handle">▲ 디자인 & 컨트롤 ▲</div>
                <div class="st-drawer-content">
                     <div id="st-settings-accordion">
                        <div class="st-accordion-item active">
                            <div class="st-accordion-header">헤더 스타일</div>
                            <div class="st-accordion-content">
                                <div class="st-control-group">
                                    <label>헤더 텍스트</label><input type="text" id="st-setting-header-text" value="썰쑈">
                                    <div class="st-flex-group" style="margin-top:10px;">
                                        <div><label>배경 색상</label><input type="color" id="st-setting-header-bg" value="#e82c43"></div>
                                        <div><label>글자 색상</label><input type="color" id="st-setting-header-color" value="#FFFFFF"></div>
                                    </div>
                                    <div class="st-flex-group" style="margin-top:10px;">
                                        <div><label>폰트</label><select id="st-setting-header-font"></select></div>
                                        <div><label>크기</label><input type="number" id="st-setting-header-size" value="24"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                         <div class="st-accordion-item">
                            <div class="st-accordion-header">스크립트 스타일 (선택된 카드)</div>
                            <div class="st-accordion-content">
                                <div class="st-control-group">
                                    <label>텍스트 색상</label><input type="color" id="st-setting-script-color" value="#000000">
                                    <div class="st-flex-group" style="margin-top:10px;">
                                        <div><label>폰트</label><select id="st-setting-script-font"></select></div>
                                        <div><label>크기</label><input type="number" id="st-setting-script-size" value="24"></div>
                                    </div>
                                    <div class="st-flex-group" style="margin-top:10px;">
                                        <div><label>X</label><input type="number" id="st-setting-script-x" value="0"></div>
                                        <div><label>Y</label><input type="number" id="st-setting-script-y" value="0"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="st-accordion-item">
                            <div class="st-accordion-header">프로젝트 정보</div>
                            <div class="st-accordion-content">
                                 <div class="st-control-group">
                                    <label>제목</label><input type="text" id="st-setting-project-title" value="">
                                    <label style="margin-top:10px;">작성자</label><input type="text" id="st-setting-project-author" value="">
                                    <label style="margin-top:10px;">조회수</label><input type="number" id="st-setting-project-views" value="0">
                                    <div class="st-flex-group" style="margin-top:10px;">
                                        <div><label>제목 색상</label><input type="color" id="st-setting-title-color" value="#000000"></div>
                                        <div><label>작성자/조회수 색상</label><input type="color" id="st-setting-meta-color" value="#555555"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="st-accordion-item">
                            <div class="st-accordion-header">배경음악 설정</div>
                            <div class="st-accordion-content">
                                 <div class="st-control-group">
                                    <label>전체 배경음악 선택</label><select id="st-setting-global-bgm"></select>
                                    <label style="margin-top:10px;">BGM 볼륨</label><input type="range" id="st-setting-global-bgm-volume" min="0" max="1" step="0.01" value="0.3">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 모달 창들 -->
    <div id="st-modal-smart-script" class="st-modal-overlay">
        <div class="st-modal-dialog">
            <h2>스마트 대본 붙여넣기</h2>
            <p>대본을 여기에 붙여넣으세요. 빈 줄을 기준으로 각 문단이 별개의 스크립트 카드로 자동 생성됩니다.</p>
            <textarea id="st-smart-script-textarea" placeholder="여기에 대본을 붙여넣으세요..."></textarea>
            <div class="st-modal-actions">
                <button id="st-btn-smart-script-cancel" class="cancel">취소</button>
                <button id="st-btn-smart-script-confirm">확인</button>
            </div>
        </div>
    </div>
    <div id="st-modal-bgm" class="st-modal-overlay">
        <div class="st-modal-dialog">
            <h2>BGM 구간 설정</h2>
            <p>오디오 파형 위에서 원하는 구간을 드래그하여 선택하세요.</p>
            <div id="st-waveform-container"><div id="st-waveform-loading">BGM 로딩 중...</div></div>
            <div class="st-waveform-controls">
                <button id="st-btn-bgm-play-pause">재생/일시정지</button>
                <button id="st-btn-bgm-play-region">선택 구간 미리듣기</button>
                <span id="st-bgm-time-display">0.00s - 0.00s</span>
            </div>
            <div class="st-modal-actions">
                <button id="st-btn-bgm-cancel" class="cancel">취소</button>
                <button id="st-btn-bgm-confirm">확인</button>
            </div>
        </div>
    </div>
    <audio id="st-tts-player" style="display:none;"></audio>
    <audio id="st-bgm-player" style="display:none;" loop></audio>
    <audio id="st-sfx-player" style="display:none;"></audio>
    
    <!-- 라이브러리 로드 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/6.4.0/wavesurfer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/6.4.0/plugin/wavesurfer.regions.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // ... (이전의 모든 JS 코드와 동일)
    });
    </script>
</body>
</html>
